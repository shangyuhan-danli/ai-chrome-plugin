# AI Chat Extension - 测试说明

## 修改内容

已修改聊天窗口的显示方式，现在聊天窗口会将页面内容挤压到左侧，而不是覆盖页面内容。

### 主要改动

1. **页面布局调整**：
   - 聊天窗口固定在右侧（宽度 400px）
   - 页面 body 添加 `margin-right: 400px`，将内容挤压到左侧
   - 页面内容会平滑过渡（0.3s 动画）

2. **固定定位元素处理**：
   - 自动调整页面中固定定位元素的位置
   - 防止固定元素被聊天窗口遮挡

3. **响应式高度**：
   - 聊天窗口高度自适应浏览器窗口高度
   - 使用 ResizeObserver 监听窗口大小变化

## 安装测试步骤

1. **加载扩展**：
   ```bash
   # 确保已编译
   npm run build
   ```

2. **在 Chrome 中加载**：
   - 打开 Chrome 浏览器
   - 访问 `chrome://extensions/`
   - 开启右上角的"开发者模式"
   - 点击"加载已解压的扩展程序"
   - 选择项目的 `dist` 目录

3. **测试功能**：
   - 访问任意网页（如 https://www.baidu.com）
   - 点击浏览器工具栏的扩展图标
   - 点击"打开聊天窗口（内嵌）"
   - 观察页面内容是否被挤压到左侧

## 预期效果

### ✅ 正确效果
- 聊天窗口出现在右侧，宽度 400px
- 页面内容向左移动，不被遮挡
- 页面内容宽度 = 浏览器宽度 - 400px
- 有平滑的过渡动画
- 关闭聊天窗口后，页面恢复原状

### ❌ 错误效果（已修复）
- ~~聊天窗口覆盖页面内容~~
- ~~页面内容被遮挡~~
- ~~需要滚动才能看到被遮挡的内容~~

## 功能测试清单

- [ ] 打开聊天窗口，页面内容向左挤压
- [ ] 关闭聊天窗口，页面内容恢复
- [ ] 固定聊天窗口，刷新页面后仍然保持打开状态
- [ ] 取消固定，关闭页面后不再自动打开
- [ ] 在聊天窗口中发送消息，收到 AI 回复
- [ ] 全屏打开聊天窗口（新标签页）
- [ ] 调整浏览器窗口大小，聊天窗口高度自适应

## 已知问题

1. **某些网站可能有特殊布局**：
   - 部分使用复杂 CSS 的网站可能需要额外调整
   - 如遇到问题，请记录网站 URL 和具体表现

2. **固定定位元素**：
   - 目前只处理了内联样式的固定定位元素
   - CSS 类定义的固定定位元素可能需要额外处理

## 下一步优化建议

1. **可调整宽度**：允许用户拖动调整聊天窗口宽度
2. **位置选择**：支持左侧或右侧显示
3. **最小化功能**：支持将聊天窗口最小化为小图标
4. **快捷键支持**：添加键盘快捷键快速打开/关闭

## 技术细节

### CSS 注入策略
```css
/* 调整 body，为聊天窗口腾出空间 */
body {
  margin-right: 400px !important;
  transition: margin-right 0.3s ease !important;
  box-sizing: border-box !important;
}

/* 防止页面横向滚动 */
html {
  overflow-x: hidden !important;
}

/* 处理固定定位的元素，防止它们被遮挡 */
body > *[style*="position: fixed"]:not(#ai-chat-container),
body > *[style*="position:fixed"]:not(#ai-chat-container) {
  right: 400px !important;
  transition: right 0.3s ease !important;
}
```

### 清理机制
- 关闭聊天窗口时，自动移除注入的样式
- 断开 ResizeObserver，避免内存泄漏
- 清理事件监听器

## 反馈

如有任何问题或建议，请记录：
- 浏览器版本
- 测试网站 URL
- 具体问题描述
- 截图（如有）

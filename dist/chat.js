import{d as A,o as S,p,a as n,c as a,e,n as f,i as w,F as I,g as B,b as T,j as b,v as E,q as H,w as P,r as i,s as N,t as y,_ as V,f as L}from"./chunks/_plugin-vue_export-helper-C2GHlnqk.js";const j={class:"chat-container"},D={class:"chat-header"},G={class:"header-right"},U={key:0,class:"empty-state"},F={class:"message-avatar"},K={key:0,viewBox:"0 0 24 24",fill:"currentColor"},O={key:1,viewBox:"0 0 24 24",fill:"currentColor"},R={class:"message-content-wrapper"},q={class:"message-content"},$={class:"message-time"},J={key:1,class:"message assistant"},Q={class:"chat-input-area"},W=["onKeydown"],X=["disabled"],Y=A({__name:"App",setup(se){const v=i(),m=i(),r=i(""),d=i(!1),c=i([]),l=i(1),u=i(!1),g=N(()=>window.self!==window.top);S(async()=>{const s=new URLSearchParams(window.location.search).get("sessionId");s&&(l.value=parseInt(s)),await _(),p(()=>{var t;(t=m.value)==null||t.focus()}),window.addEventListener("message",t=>{t.data.type==="PIN_STATUS_CHANGED"&&(u.value=t.data.isPinned)})});const _=async()=>{const o=await chrome.runtime.sendMessage({type:"GET_MESSAGES",payload:{sessionId:l.value}});o.success&&(c.value=o.data,p(h))},k=async()=>{if(!r.value.trim()||d.value)return;const o=r.value.trim();r.value="",c.value.push({sessionId:l.value,role:"user",content:o,createdAt:Date.now()}),p(h),d.value=!0;try{const s=await chrome.runtime.sendMessage({type:"SEND_MESSAGE",payload:{sessionId:l.value,content:o}});s.success&&(c.value.push({sessionId:l.value,role:"assistant",content:s.response,createdAt:Date.now()}),p(h))}catch(s){console.error("发送消息失败:",s)}finally{d.value=!1}},h=()=>{v.value&&(v.value.scrollTop=v.value.scrollHeight)},C=o=>new Date(o).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),x=()=>{console.log("togglePin clicked, current isPinned:",u.value),window.parent&&window.parent!==window?(console.log("Sending PIN_CHAT message to parent"),window.parent.postMessage({type:"PIN_CHAT"},"*"),u.value=!u.value):console.log("Not in iframe, cannot pin")},M=()=>{window.parent&&window.parent!==window?window.parent.postMessage({type:"CLOSE_CHAT"},"*"):window.close()},z=()=>{const o=chrome.runtime.getURL(`chat.html?sessionId=${l.value}`);chrome.tabs.create({url:o}),window.parent&&window.parent.postMessage({type:"CLOSE_CHAT"},"*")};return(o,s)=>(n(),a("div",j,[e("div",D,[s[4]||(s[4]=e("div",{class:"header-left"},[e("div",{class:"logo-icon"},[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[e("path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})])]),e("h3",null,"AI Chat Assistant")],-1)),e("div",G,[g.value?(n(),a("button",{key:0,class:f(["icon-btn",{active:u.value}]),onClick:x,title:"固定窗口"},[...s[1]||(s[1]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[e("path",{d:"M16 4v8l3 3-2 2-3-3-4 4-2-2 4-4-3-3 2-2 3 3V4h2z","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)])],2)):w("",!0),g.value?(n(),a("button",{key:1,class:"icon-btn",onClick:z,title:"全屏打开"},[...s[2]||(s[2]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[e("path",{d:"M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)])])):w("",!0),e("button",{class:"icon-btn",onClick:M,title:"关闭"},[...s[3]||(s[3]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[e("line",{x1:"18",y1:"6",x2:"6",y2:"18","stroke-width":"2","stroke-linecap":"round"}),e("line",{x1:"6",y1:"6",x2:"18",y2:"18","stroke-width":"2","stroke-linecap":"round"})],-1)])])])]),e("div",{class:"chat-messages",ref_key:"messagesContainer",ref:v},[c.value.length===0?(n(),a("div",U,[...s[5]||(s[5]=[e("svg",{class:"empty-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[e("path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1),e("p",null,"开始对话吧！",-1)])])):w("",!0),(n(!0),a(I,null,B(c.value,t=>(n(),a("div",{key:t.id,class:f(["message",t.role])},[e("div",F,[t.role==="user"?(n(),a("svg",K,[...s[6]||(s[6]=[e("path",{d:"M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"},null,-1)])])):(n(),a("svg",O,[...s[7]||(s[7]=[e("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm-1-13h2v6h-2zm0 8h2v2h-2z"},null,-1)])]))]),e("div",R,[e("div",q,y(t.content),1),e("div",$,y(C(t.createdAt)),1)])],2))),128)),d.value?(n(),a("div",J,[...s[8]||(s[8]=[T('<div class="message-avatar" data-v-d9c89a90><svg viewBox="0 0 24 24" fill="currentColor" data-v-d9c89a90><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm-1-13h2v6h-2zm0 8h2v2h-2z" data-v-d9c89a90></path></svg></div><div class="message-content-wrapper" data-v-d9c89a90><div class="typing-indicator" data-v-d9c89a90><span data-v-d9c89a90></span><span data-v-d9c89a90></span><span data-v-d9c89a90></span></div></div>',2)])])):w("",!0)],512),e("div",Q,[b(e("textarea",{"onUpdate:modelValue":s[0]||(s[0]=t=>r.value=t),onKeydown:H(P(k,["exact","prevent"]),["enter"]),placeholder:"输入消息... (Enter发送)",rows:"1",ref_key:"inputArea",ref:m},null,40,W),[[E,r.value]]),e("button",{class:"send-btn",onClick:k,disabled:!r.value.trim()||d.value},[...s[9]||(s[9]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[e("line",{x1:"22",y1:"2",x2:"11",y2:"13","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}),e("polygon",{points:"22 2 15 22 11 13 2 9 22 2","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)])],8,X)])]))}}),Z=V(Y,[["__scopeId","data-v-d9c89a90"]]),ee=L(Z);ee.mount("#app");

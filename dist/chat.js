import{d as ve,f as pe,m as x,o as l,c as i,b as t,t as _,g as h,n as j,F as z,r as P,h as q,v as Q,w as V,p as ke,l as u,q as U,s as ge,_ as fe,e as he}from"./chunks/_plugin-vue_export-helper-C6Ao9Pha.js";const ye={class:"chat-wrapper"},me={class:"chat-container"},we={class:"chat-header"},xe={class:"header-left"},_e={class:"header-title"},Ce={class:"header-badges"},be=["title"],Me={key:1,class:"model-badge"},Ae={class:"header-right"},Ie={key:0,class:"empty-state"},Te={key:0,class:"message-box user-box"},Se={key:1,class:"assistant-content"},Be={key:0,class:"think-block"},Ee={class:"think-content"},Ne={key:0,class:"message-box assistant-box"},Le={class:"block-content"},je={key:1,class:"tool-block"},ze={class:"tool-header"},He={class:"tool-name"},De={key:0,class:"tool-badge approved"},Pe={key:1,class:"tool-badge rejected"},Ve={class:"tool-params"},Ue={key:0,class:"tool-actions"},$e=["onClick"],Ge=["onClick"],Re={key:1,class:"message assistant"},Oe={class:"chat-input-area"},Fe={key:0,class:"agent-selected-indicator"},Je={key:0,class:"agent-dropdown-menu"},Ke={class:"agent-dropdown-header"},qe={class:"agent-dropdown-list"},Qe={key:0,class:"agent-dropdown-loading"},We={key:1,class:"agent-dropdown-empty"},Xe=["onClick"],Ye={class:"agent-dropdown-info"},Ze={class:"agent-dropdown-name"},et={key:0,class:"recommended-tag"},tt={class:"agent-dropdown-desc"},st={key:0,class:"agent-check"},ot=["onKeydown"],nt=["disabled"],at=ve({__name:"App",setup(rt){const L=u(),H=u(),T=u(""),C=u(!1),n=u([]),y=u(1),B=u(!1),W=U(()=>{if(n.value.length===0)return!1;const s=n.value[n.value.length-1];return s.role!=="assistant"?!1:s.blocks.some(e=>e.type==="tool_use"&&e.status==="pending")}),S=u([]),k=u(null),b=u(!1),E=u(""),D=u(!1),N=u(null),$=u(""),G=u(""),M=u("gpt-3.5-turbo"),m=u(""),w=u(!1),R=U(()=>window.self!==window.top),O=U(()=>{if(!E.value)return S.value;const s=E.value.toLowerCase();return S.value.filter(e=>{var o;return e.name.toLowerCase().includes(s)||e.description.toLowerCase().includes(s)||((o=e.tags)==null?void 0:o.some(r=>r.toLowerCase().includes(s)))})});pe(async()=>{const s=new URLSearchParams(window.location.search),e=s.get("sessionId");e&&(y.value=parseInt(e));const o=s.get("pageUrl"),r=s.get("pageTitle");o&&($.value=decodeURIComponent(o)),r&&(G.value=decodeURIComponent(r)),await ee(),await F(),await X(),x(()=>{var a;(a=H.value)==null||a.focus()}),window.addEventListener("message",a=>{a.data.type==="PIN_STATUS_CHANGED"&&(B.value=a.data.isPinned),a.data.type==="PAGE_INFO"&&($.value=a.data.url,G.value=a.data.title,F())}),document.addEventListener("click",a=>{a.target.closest(".agent-selector")||(b.value=!1)})});const F=async()=>{D.value=!0;try{const s=await chrome.runtime.sendMessage({type:"GET_AGENTS",payload:{userId:"default_user"}});if(s.success&&s.data){if(S.value=s.data.agents||[],N.value=s.data.recommended||null,N.value&&!k.value){const e=S.value.find(o=>o.id===N.value);e&&(k.value=e)}!k.value&&S.value.length>0&&(k.value=S.value[0])}}catch(s){console.error("åŠ è½½ Agent åˆ—è¡¨å¤±è´¥:",s)}finally{D.value=!1}},X=async()=>{try{const s=await chrome.runtime.sendMessage({type:"GET_SETTING",payload:{key:"model"}});s!=null&&s.success&&s.data?M.value=s.data:M.value="gpt-3.5-turbo"}catch(s){console.error("åŠ è½½æ¨¡å‹è®¾ç½®å¤±è´¥:",s),M.value="gpt-3.5-turbo"}},Y=()=>{b.value=!b.value,b.value&&(E.value="")},Z=s=>{k.value=s,b.value=!1},ee=async()=>{const s=await chrome.runtime.sendMessage({type:"GET_MESSAGES",payload:{sessionId:y.value}});s.success&&(n.value=s.data.map(e=>({...e,blocks:e.blocks||[{type:"text",text:e.content}]})),x(A))},te=s=>s.blocks.filter(o=>o.type==="text").map(o=>o.text).join(""),se=s=>JSON.stringify(s,null,2),J=async()=>{if(!T.value.trim()||C.value||w.value||W.value)return;const s=T.value.trim();T.value="";const e={sessionId:y.value,role:"user",blocks:[{type:"text",text:s}],createdAt:Date.now()};n.value.push(e),x(A),k.value&&k.value.id?await oe(s):await ne(s)},oe=async s=>{w.value=!0,m.value="";const e={sessionId:y.value,role:"assistant",blocks:[{type:"text",text:""}],createdAt:Date.now()};n.value.push(e);const o=n.value.length-1;let r="",a=null;try{const p=chrome.runtime.connect({name:"chat-stream"});p.onMessage.addListener(f=>{if(f.type==="data"){const c=f.data;if(c.content){m.value+=c.content;const d=n.value[o].blocks.find(g=>g.type==="text");d&&d.type==="text"&&(d.text=m.value),x(A)}if(c.think&&c.think.reasoning_content&&(r=c.think.reasoning_content),c.toolCall&&c.toolCall.tool_name)try{a={type:"tool_use",id:`tool_${Date.now()}`,name:c.toolCall.tool_name,input:JSON.parse(c.toolCall.arguments||"{}"),status:"pending"}}catch(d){console.error("è§£æå·¥å…·å‚æ•°å¤±è´¥:",d)}c.statistic&&console.log("Token ä½¿ç”¨ç»Ÿè®¡:",c.statistic.token_usage)}else if(f.type==="done")w.value=!1,n.value[o].blocks=[],r&&(n.value[o].think=r),a?(n.value[o].blocks.push(a),n.value[o].isComplete=!1):(!r&&m.value&&n.value[o].blocks.push({type:"text",text:m.value}),n.value[o].isComplete=!0),p.disconnect(),x(A);else if(f.type==="error"){console.error("æµå¼å“åº”é”™è¯¯:",f.error);const c=n.value[o].blocks.find(d=>d.type==="text");c&&c.type==="text"&&(c.text=`é”™è¯¯: ${f.error}`),w.value=!1,p.disconnect()}}),p.postMessage({agentId:k.value.id,sessionId:y.value,message:s,model:M.value,userId:"default_user",role:"user"})}catch(p){console.error("å‘é€æµå¼æ¶ˆæ¯å¤±è´¥:",p);const f=n.value[o].blocks.find(c=>c.type==="text");f&&f.type==="text"&&(f.text=`å‘é€å¤±è´¥: ${p}`),w.value=!1}},ne=async s=>{C.value=!0;try{const e=await chrome.runtime.sendMessage({type:"SEND_MESSAGE",payload:{sessionId:y.value,content:s}});if(e.success){const o={sessionId:y.value,role:"assistant",blocks:e.blocks||[{type:"text",text:e.response}],createdAt:Date.now(),isComplete:e.isComplete!==!1};n.value.push(o),x(A)}}catch(e){console.error("å‘é€æ¶ˆæ¯å¤±è´¥:",e)}finally{C.value=!1}},K=async(s,e)=>{var c;const o=n.value[n.value.length-1];if(o&&o.role==="assistant"){const d=o.blocks.find(g=>g.type==="tool_use"&&g.id===s);d&&(d.status=e?"approved":"rejected")}w.value=!0,m.value="";const r={sessionId:y.value,role:"assistant",blocks:[{type:"text",text:""}],createdAt:Date.now()};n.value.push(r);const a=n.value.length-1;let p="",f=null;try{const d=chrome.runtime.connect({name:"chat-stream"});d.onMessage.addListener(g=>{if(g.type==="data"){const v=g.data;if(v.content){m.value+=v.content;const I=n.value[a].blocks.find(ue=>ue.type==="text");I&&I.type==="text"&&(I.text=m.value),x(A)}if(v.think&&v.think.reasoning_content&&(p+=v.think.reasoning_content),v.toolCall&&v.toolCall.tool_name)try{f={type:"tool_use",id:`tool_${Date.now()}`,name:v.toolCall.tool_name,input:JSON.parse(v.toolCall.arguments||"{}"),status:"pending"}}catch(I){console.error("è§£æå·¥å…·å‚æ•°å¤±è´¥:",I)}v.statistic&&console.log("Token ä½¿ç”¨ç»Ÿè®¡:",v.statistic.token_usage)}else if(g.type==="done")w.value=!1,n.value[a].blocks=[],p&&(n.value[a].think=p),f?(n.value[a].blocks.push(f),n.value[a].isComplete=!1):(!p&&m.value&&n.value[a].blocks.push({type:"text",text:m.value}),n.value[a].isComplete=!0),d.disconnect(),x(A);else if(g.type==="error"){console.error("æµå¼å“åº”é”™è¯¯:",g.error);const v=n.value[a].blocks.find(I=>I.type==="text");v&&v.type==="text"&&(v.text=`é”™è¯¯: ${g.error}`),w.value=!1,d.disconnect()}}),d.postMessage({agentId:((c=k.value)==null?void 0:c.id)||"",sessionId:y.value,message:JSON.stringify({toolId:s,approved:e}),model:M.value,userId:"default_user",role:"function"})}catch(d){console.error("å¤„ç†å·¥å…·å“åº”å¤±è´¥:",d);const g=n.value[a].blocks.find(v=>v.type==="text");g&&g.type==="text"&&(g.text=`å‘é€å¤±è´¥: ${d}`),w.value=!1}},A=()=>{L.value&&(L.value.scrollTop=L.value.scrollHeight)},ae=()=>{console.log("togglePin clicked, current isPinned:",B.value),window.parent&&window.parent!==window?(console.log("Sending PIN_CHAT message to parent"),window.parent.postMessage({type:"PIN_CHAT"},"*"),B.value=!B.value):console.log("Not in iframe, cannot pin")},le=()=>{window.parent&&window.parent!==window?window.parent.postMessage({type:"CLOSE_CHAT"},"*"):window.close()},ie=()=>{const s=chrome.runtime.getURL(`chat.html?sessionId=${y.value}`);chrome.tabs.create({url:s}),window.parent&&window.parent.postMessage({type:"CLOSE_CHAT"},"*")},re=()=>{chrome.tabs.create({url:"https://github.com/anthropics/claude-code/issues"})},ce=()=>{const s=chrome.runtime.getURL("options.html");chrome.tabs.create({url:s})},de=async()=>{y.value=Date.now(),n.value=[],m.value="",w.value=!1,C.value=!1,x(()=>{var s;(s=H.value)==null||s.focus()})};return(s,e)=>(l(),i("div",ye,[t("div",me,[t("div",we,[t("div",xe,[e[4]||(e[4]=t("div",{class:"logo-icon"},[t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[t("path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})])],-1)),t("div",_e,[e[3]||(e[3]=t("h3",null,"AI Chat Assistant",-1)),t("div",Ce,[k.value?(l(),i("span",{key:0,class:"agent-badge",title:k.value.name},_(k.value.name),9,be)):h("",!0),M.value?(l(),i("span",Me,_(M.value),1)):h("",!0)])])]),t("div",Ae,[t("button",{class:"icon-btn",onClick:de,title:"æ–°å»ºä¼šè¯"},[...e[5]||(e[5]=[t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[t("line",{x1:"12",y1:"5",x2:"12",y2:"19","stroke-width":"2","stroke-linecap":"round"}),t("line",{x1:"5",y1:"12",x2:"19",y2:"12","stroke-width":"2","stroke-linecap":"round"})],-1)])]),t("button",{class:"icon-btn",onClick:re,title:"å¸®åŠ©æ–‡æ¡£"},[...e[6]||(e[6]=[t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[t("circle",{cx:"12",cy:"12",r:"10","stroke-width":"2"}),t("path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}),t("line",{x1:"12",y1:"17",x2:"12.01",y2:"17","stroke-width":"2","stroke-linecap":"round"})],-1)])]),t("button",{class:"icon-btn",onClick:ce,title:"è®¾ç½®"},[...e[7]||(e[7]=[t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[t("circle",{cx:"12",cy:"12",r:"3","stroke-width":"2"}),t("path",{d:"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)])]),R.value?(l(),i("button",{key:0,class:j(["icon-btn",{active:B.value}]),onClick:ae,title:"å›ºå®šçª—å£"},[...e[8]||(e[8]=[t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[t("path",{d:"M16 4v8l3 3-2 2-3-3-4 4-2-2 4-4-3-3 2-2 3 3V4h2z","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)])],2)):h("",!0),R.value?(l(),i("button",{key:1,class:"icon-btn",onClick:ie,title:"å…¨å±æ‰“å¼€"},[...e[9]||(e[9]=[t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[t("path",{d:"M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)])])):h("",!0),t("button",{class:"icon-btn",onClick:le,title:"å…³é—­"},[...e[10]||(e[10]=[t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[t("line",{x1:"18",y1:"6",x2:"6",y2:"18","stroke-width":"2","stroke-linecap":"round"}),t("line",{x1:"6",y1:"6",x2:"18",y2:"18","stroke-width":"2","stroke-linecap":"round"})],-1)])])])]),t("div",{class:"chat-messages",ref_key:"messagesContainer",ref:L},[n.value.length===0?(l(),i("div",Ie,[...e[11]||(e[11]=[t("p",null,"å¼€å§‹å¯¹è¯å§",-1)])])):h("",!0),(l(!0),i(z,null,P(n.value,o=>(l(),i("div",{key:o.id||o.createdAt,class:j(["message",o.role])},[o.role==="user"?(l(),i("div",Te,_(te(o)),1)):(l(),i("div",Se,[o.think?(l(),i("div",Be,[e[12]||(e[12]=t("div",{class:"think-header"},[t("span",{class:"think-icon"},"ğŸ’­"),t("span",{class:"think-label"},"æ€è€ƒè¿‡ç¨‹")],-1)),t("div",Ee,_(o.think),1)])):h("",!0),(l(!0),i(z,null,P(o.blocks,(r,a)=>(l(),i(z,{key:a},[r.type==="text"?(l(),i("div",Ne,[e[13]||(e[13]=t("span",{class:"block-indicator text-indicator"},"â–¶",-1)),t("span",Le,_(r.text),1)])):r.type==="tool_use"?(l(),i("div",je,[t("div",ze,[e[14]||(e[14]=t("span",{class:"block-indicator tool-indicator"},"âš™",-1)),t("span",He,_(r.name),1),r.status==="approved"?(l(),i("span",De,"å·²æ‰¹å‡†")):r.status==="rejected"?(l(),i("span",Pe,"å·²æ‹’ç»")):h("",!0)]),t("pre",Ve,_(se(r.input)),1),r.status==="pending"&&!C.value?(l(),i("div",Ue,[t("button",{class:"btn btn-approve",onClick:p=>K(r.id,!0)},"Approve",8,$e),t("button",{class:"btn btn-reject",onClick:p=>K(r.id,!1)},"Reject",8,Ge)])):h("",!0)])):h("",!0)],64))),128))]))],2))),128)),C.value?(l(),i("div",Re,[...e[15]||(e[15]=[t("div",{class:"assistant-content"},[t("div",{class:"message-box assistant-box typing"},[t("span"),t("span"),t("span")])],-1)])])):h("",!0)],512),t("div",Oe,[t("div",{class:"agent-selector",onClick:Y},[t("div",{class:j(["agent-selector-btn",{active:b.value}])},[e[16]||(e[16]=t("svg",{viewBox:"0 0 24 24",fill:"currentColor"},[t("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 3c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm0 14.2c-2.5 0-4.71-1.28-6-3.22.03-1.99 4-3.08 6-3.08 1.99 0 5.97 1.09 6 3.08-1.29 1.94-3.5 3.22-6 3.22z"})],-1)),k.value?(l(),i("span",Fe)):h("",!0)],2),b.value?(l(),i("div",Je,[t("div",Ke,[q(t("input",{type:"text","onUpdate:modelValue":e[0]||(e[0]=o=>E.value=o),placeholder:"æœç´¢ Agent...",onClick:e[1]||(e[1]=V(()=>{},["stop"]))},null,512),[[Q,E.value]])]),t("div",qe,[D.value?(l(),i("div",Qe,[...e[17]||(e[17]=[t("div",{class:"loading-spinner"},null,-1),t("span",null,"åŠ è½½ä¸­...",-1)])])):O.value.length===0?(l(),i("div",We," æš‚æ— å¯ç”¨ Agent ")):(l(!0),i(z,{key:2},P(O.value,o=>{var r,a;return l(),i("div",{key:o.id,class:j(["agent-dropdown-item",{selected:((r=k.value)==null?void 0:r.id)===o.id,recommended:o.id===N.value}]),onClick:V(p=>Z(o),["stop"])},[e[19]||(e[19]=t("div",{class:"agent-dropdown-avatar"},[t("svg",{viewBox:"0 0 24 24",fill:"currentColor"},[t("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 3c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm0 14.2c-2.5 0-4.71-1.28-6-3.22.03-1.99 4-3.08 6-3.08 1.99 0 5.97 1.09 6 3.08-1.29 1.94-3.5 3.22-6 3.22z"})])],-1)),t("div",Ye,[t("div",Ze,[ge(_(o.name)+" ",1),o.id===N.value?(l(),i("span",et,"æ¨è")):h("",!0)]),t("div",tt,_(o.description),1)]),((a=k.value)==null?void 0:a.id)===o.id?(l(),i("div",st,[...e[18]||(e[18]=[t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[t("polyline",{points:"20 6 9 17 4 12","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)])])):h("",!0)],10,Xe)}),128))])])):h("",!0)]),q(t("textarea",{"onUpdate:modelValue":e[2]||(e[2]=o=>T.value=o),onKeydown:ke(V(J,["exact","prevent"]),["enter"]),placeholder:"è¾“å…¥æ¶ˆæ¯... (Enterå‘é€)",rows:"1",ref_key:"inputArea",ref:H},null,40,ot),[[Q,T.value]]),t("button",{class:"send-btn",onClick:J,disabled:!T.value.trim()||C.value},[...e[20]||(e[20]=[t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[t("line",{x1:"22",y1:"2",x2:"11",y2:"13","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}),t("polygon",{points:"22 2 15 22 11 13 2 9 22 2","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)])],8,nt)])])]))}}),lt=fe(at,[["__scopeId","data-v-1b5b9def"]]),it=he(lt);it.mount("#app");

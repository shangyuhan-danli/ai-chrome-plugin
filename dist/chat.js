var rt=Object.defineProperty;var it=(z,r,c)=>r in z?rt(z,r,{enumerable:!0,configurable:!0,writable:!0,value:c}):z[r]=c;var Se=(z,r,c)=>it(z,typeof r!="symbol"?r+"":r,c);import{d as lt,f as ct,m as L,o as p,c as v,b as t,t as C,g as I,w as P,n as O,p as ue,F as Y,r as oe,h as de,v as pe,q as ve,s as ut,l as f,u as me,_ as dt,e as pt}from"./chunks/_plugin-vue_export-helper-BVLuoGCU.js";class vt{constructor(){Se(this,"tools",new Map);this.registerBuiltinTools()}registerBuiltinTools(){this.register({name:"page_action",description:"åœ¨ç”¨æˆ·å½“å‰æµè§ˆçš„ç½‘é¡µä¸Šæ‰§è¡Œæ“ä½œï¼Œå¦‚å¡«å……è¾“å…¥æ¡†ã€ç‚¹å‡»æŒ‰é’®ã€é«˜äº®æ–‡å­—ç­‰ã€‚å¯ä»¥æ‰¹é‡æ‰§è¡Œå¤šä¸ªæ“ä½œã€‚",parameters:{type:"object",properties:{actions:{type:"array",description:"è¦æ‰§è¡Œçš„æ“ä½œåˆ—è¡¨",items:{type:"object",properties:{action:{type:"string",enum:["fill","click","doubleClick","rightClick","highlight","underline","select","selectText","check","scroll","read","hover","type","press","drag","wait","focus","blur","clear","getAttribute","getProperty","navigate","scrollIntoView","switchFrame","handleDialog","setLocalStorage","getLocalStorage","clearLocalStorage","setCookie","getCookie","clearCookies","copyToClipboard","pasteFromClipboard","upload","evaluate","addListItem","removeListItem","editListItem","setContent","appendContent","prependContent","insertHTML"],description:"æ“ä½œç±»åž‹: fill(å¡«å……è¾“å…¥æ¡†), click(ç‚¹å‡»), doubleClick(åŒå‡»), rightClick(å³é”®), highlight(é«˜äº®), underline(ä¸‹åˆ’çº¿), select(é€‰æ‹©), selectText(é€‰ä¸­æ–‡æœ¬), check(å‹¾é€‰), scroll(æ»šåŠ¨), read(è¯»å–), hover(æ‚¬åœ), type(æ‰“å­—), press(æŒ‰é”®), drag(æ‹–æ‹½), wait(ç­‰å¾…), focus(èšç„¦), blur(å¤±ç„¦), clear(æ¸…ç©º), getAttribute(èŽ·å–å±žæ€§), getProperty(èŽ·å–å±žæ€§å€¼), navigate(å¯¼èˆª), scrollIntoView(æ»šåŠ¨åˆ°å…ƒç´ ), switchFrame(åˆ‡æ¢iframe), handleDialog(å¤„ç†å¼¹çª—), setLocalStorage(è®¾ç½®å­˜å‚¨), getLocalStorage(èŽ·å–å­˜å‚¨), clearLocalStorage(æ¸…é™¤å­˜å‚¨), setCookie(è®¾ç½®Cookie), getCookie(èŽ·å–Cookie), clearCookies(æ¸…é™¤Cookies), copyToClipboard(å¤åˆ¶), pasteFromClipboard(ç²˜è´´), upload(ä¸Šä¼ æ–‡ä»¶), evaluate(æ‰§è¡ŒJS), addListItem(æ·»åŠ åˆ—è¡¨é¡¹), removeListItem(åˆ é™¤åˆ—è¡¨é¡¹), editListItem(ç¼–è¾‘åˆ—è¡¨é¡¹), setContent(è®¾ç½®å†…å®¹), appendContent(è¿½åŠ å†…å®¹), prependContent(å‰ç½®å†…å®¹), insertHTML(æ’å…¥HTML)"},target:{type:"object",description:"ç›®æ ‡å…ƒç´ ",properties:{elementId:{type:"string",description:"å…ƒç´ ID (ä»Žé¡µé¢ä¸Šä¸‹æ–‡èŽ·å–)"},selector:{type:"string",description:"CSSé€‰æ‹©å™¨ (å¤‡ç”¨)"},description:{type:"string",description:"å…ƒç´ æè¿° (ç”¨äºŽç¡®è®¤)"}}},params:{type:"object",description:"æ“ä½œå‚æ•°",properties:{value:{type:"string",description:"å¡«å……çš„å€¼ã€é€‰æ‹©çš„é€‰é¡¹ã€è¾“å…¥çš„æ–‡æœ¬æˆ–æŒ‰é”®å"},color:{type:"string",description:"é«˜äº®é¢œè‰² (å¦‚ #ffeb3b)"},direction:{type:"string",enum:["up","down","top","bottom"],description:"æ»šåŠ¨æ–¹å‘"},delay:{type:"number",description:"è¾“å…¥å»¶è¿Ÿï¼ˆæ¯«ç§’ï¼‰ï¼Œç”¨äºŽtypeæ“ä½œ"},key:{type:"string",description:"æŒ‰é”®åï¼ˆEnter, Tab, Escapeç­‰ï¼‰"},destination:{type:"object",description:"æ‹–æ‹½ç›®æ ‡ä½ç½®",properties:{selector:{type:"string",description:"ç›®æ ‡å…ƒç´ CSSé€‰æ‹©å™¨"},x:{type:"number",description:"ç›®æ ‡Xåæ ‡"},y:{type:"number",description:"ç›®æ ‡Yåæ ‡"}}},timeout:{type:"number",description:"ç­‰å¾…è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰"},condition:{type:"string",enum:["visible","hidden","exists"],description:"ç­‰å¾…æ¡ä»¶"},behavior:{type:"string",enum:["auto","smooth"],description:"æ»šåŠ¨è¡Œä¸º"},block:{type:"string",enum:["start","center","end","nearest"],description:"æ»šåŠ¨å¯¹é½æ–¹å¼"},attribute:{type:"string",description:"è¦èŽ·å–çš„å±žæ€§å"},property:{type:"string",description:"è¦èŽ·å–çš„å±žæ€§å€¼å"},navigateAction:{type:"string",enum:["goto","back","forward","reload"],description:"å¯¼èˆªæ“ä½œç±»åž‹"},url:{type:"string",description:"å¯¼èˆªURLï¼ˆnavigateAction=gotoæ—¶ä½¿ç”¨ï¼‰"},frameSelector:{type:"string",description:"iframeé€‰æ‹©å™¨"},dialogAction:{type:"string",enum:["accept","dismiss"],description:"å¼¹çª—å¤„ç†æ–¹å¼"},promptText:{type:"string",description:"promptå¼¹çª—çš„è¾“å…¥å€¼"},prefix:{type:"string",description:"localStorageé”®åå‰ç¼€ï¼ˆç”¨äºŽæ‰¹é‡æ¸…é™¤ï¼‰"},name:{type:"string",description:"Cookieåç§°"},cookieOptions:{type:"object",description:"Cookieé€‰é¡¹",properties:{expires:{type:"number",description:"è¿‡æœŸæ—¶é—´ï¼ˆç§’ï¼‰"},path:{type:"string",description:"è·¯å¾„"},domain:{type:"string",description:"åŸŸå"},secure:{type:"boolean",description:"æ˜¯å¦ä»…HTTPS"}}},text:{type:"string",description:"è¦å¤åˆ¶çš„æ–‡æœ¬ï¼ˆcopyToClipboardä½¿ç”¨ï¼‰"},searchText:{type:"string",description:"è¦é€‰ä¸­çš„æ–‡æœ¬å†…å®¹ï¼ˆselectTextä½¿ç”¨ï¼‰"},startOffset:{type:"number",description:"é€‰æ‹©èµ·å§‹åç§»ï¼ˆselectTextä½¿ç”¨ï¼‰"},endOffset:{type:"number",description:"é€‰æ‹©ç»“æŸåç§»ï¼ˆselectTextä½¿ç”¨ï¼‰"},script:{type:"string",description:"è¦æ‰§è¡Œçš„JavaScriptä»£ç ï¼ˆevaluateä½¿ç”¨ï¼‰"},files:{type:"array",description:"è¦ä¸Šä¼ çš„æ–‡ä»¶åˆ—è¡¨ï¼ˆuploadä½¿ç”¨ï¼‰",items:{type:"object",properties:{name:{type:"string",description:"æ–‡ä»¶å"},type:{type:"string",description:"MIMEç±»åž‹"},content:{type:"string",description:"base64ç¼–ç çš„æ–‡ä»¶å†…å®¹"}}}},listSelector:{type:"string",description:"åˆ—è¡¨å®¹å™¨é€‰æ‹©å™¨ï¼ˆaddListItemä½¿ç”¨ï¼‰"},itemContent:{type:"string",description:"åˆ—è¡¨é¡¹å†…å®¹ï¼ˆaddListItem/editListItemä½¿ç”¨ï¼‰"},position:{type:"string",enum:["before","after","first","last"],description:"æ’å…¥ä½ç½®ï¼ˆaddListItemä½¿ç”¨ï¼‰"},itemIndex:{type:"number",description:"åˆ—è¡¨é¡¹ç´¢å¼•ï¼ˆremoveListItemä½¿ç”¨ï¼‰"},content:{type:"string",description:"æ–‡æœ¬å†…å®¹ï¼ˆsetContent/appendContent/prependContentä½¿ç”¨ï¼‰"},html:{type:"string",description:"HTMLå†…å®¹ï¼ˆinsertHTMLä½¿ç”¨ï¼‰"},insertPosition:{type:"string",enum:["beforebegin","afterbegin","beforeend","afterend"],description:"HTMLæ’å…¥ä½ç½®: beforebegin(å…ƒç´ å‰), afterbegin(å†…éƒ¨å¼€å¤´), beforeend(å†…éƒ¨æœ«å°¾), afterend(å…ƒç´ åŽ)"}}}},required:["action","target"]}}},required:["actions"]},execute:async(r,c)=>{const m=r.actions||[r],k=await chrome.tabs.sendMessage(c,{type:"EXECUTE_BATCH_ACTIONS",payload:m});return(k==null?void 0:k.data)||{success:!1,error:"æ‰§è¡Œå¤±è´¥"}}}),this.register({name:"screenshot",description:"æˆªå–å½“å‰é¡µé¢çš„æˆªå›¾ï¼Œæ”¯æŒå¯è§†åŒºåŸŸæˆªå›¾æˆ–å®Œæ•´é¡µé¢æ»šåŠ¨æˆªå›¾ï¼Œè‡ªåŠ¨ä¿å­˜åˆ°å‰ªè´´æ¿ã€‚ç”¨æˆ·å¯ä»¥ç›´æŽ¥ç²˜è´´ä½¿ç”¨ã€‚",parameters:{type:"object",properties:{format:{type:"string",enum:["png","jpeg"],description:"å›¾ç‰‡æ ¼å¼ï¼Œé»˜è®¤png"},quality:{type:"number",description:"JPEGè´¨é‡(0-100)ï¼Œä»…format=jpegæ—¶æœ‰æ•ˆ"},autoDownload:{type:"boolean",description:"æ˜¯å¦è‡ªåŠ¨ä¸‹è½½å›¾ç‰‡ï¼Œé»˜è®¤false"},filename:{type:"string",description:"ä¸‹è½½æ–‡ä»¶åï¼Œé»˜è®¤screenshot_{timestamp}.png"},fullPage:{type:"boolean",description:"æ˜¯å¦æˆªå–å®Œæ•´é¡µé¢ï¼ˆè‡ªåŠ¨æ»šåŠ¨æˆªå›¾ï¼‰ï¼Œé»˜è®¤falseï¼ˆä»…æˆªå–å¯è§†åŒºåŸŸï¼‰"}}},execute:async(r,c)=>{try{const m=r.format||"png",k=r.fullPage||!1;let a;if(k){const b=await chrome.tabs.sendMessage(c,{type:"CAPTURE_FULL_PAGE",payload:{format:m,quality:r.quality}});if(!(b!=null&&b.success))return{success:!1,error:(b==null?void 0:b.error)||"å…¨é¡µæˆªå›¾å¤±è´¥"};a=b.data}else{const b={format:m};m==="jpeg"&&r.quality&&(b.quality=r.quality),a=await chrome.tabs.captureVisibleTab(b)}const N=await(await fetch(a)).blob();let D=!1,_=null;try{await navigator.clipboard.write([new ClipboardItem({[N.type]:N})]),D=!0}catch(b){try{await chrome.tabs.sendMessage(c,{type:"COPY_IMAGE_TO_CLIPBOARD",payload:{dataUrl:a}}),D=!0}catch(U){_=String(U),console.warn("ä¿å­˜åˆ°å‰ªè´´æ¿å¤±è´¥:",b,U)}}if(r.autoDownload){const b=r.filename||`screenshot_${Date.now()}.${m}`;await chrome.downloads.download({url:a,filename:b,saveAs:!1})}return{success:!0,data:a,message:D?"æˆªå›¾å·²ä¿å­˜åˆ°å‰ªè´´æ¿ï¼Œä½ å¯ä»¥ç›´æŽ¥ç²˜è´´ä½¿ç”¨ï¼ˆCtrl+V/Cmd+Vï¼‰":"æˆªå›¾å·²ç”Ÿæˆï¼Œä½†å‰ªè´´æ¿ä¿å­˜å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨ä¿å­˜å›¾ç‰‡",clipboardSaved:D,clipboardError:_,autoDownload:r.autoDownload||!1,fullPage:k}}catch(m){return{success:!1,error:String(m)}}}}),this.register({name:"download",description:"ä¸‹è½½æŒ‡å®šURLçš„æ–‡ä»¶åˆ°æœ¬åœ°ã€‚",parameters:{type:"object",properties:{url:{type:"string",description:"è¦ä¸‹è½½çš„æ–‡ä»¶URL"},filename:{type:"string",description:"ä¿å­˜çš„æ–‡ä»¶åï¼ˆå¯é€‰ï¼‰"},saveAs:{type:"boolean",description:"æ˜¯å¦æ˜¾ç¤ºå¦å­˜ä¸ºå¯¹è¯æ¡†"}},required:["url"]},execute:async r=>{try{const c={url:r.url};return r.filename&&(c.filename=r.filename),r.saveAs!==void 0&&(c.saveAs=r.saveAs),{success:!0,downloadId:await chrome.downloads.download(c)}}catch(c){return{success:!1,error:String(c)}}}}),this.register({name:"setViewport",description:"è°ƒæ•´æµè§ˆå™¨çª—å£å¤§å°ä»¥æ¨¡æ‹Ÿä¸åŒè®¾å¤‡çš„è§†å£ã€‚",parameters:{type:"object",properties:{width:{type:"number",description:"è§†å£å®½åº¦ï¼ˆåƒç´ ï¼‰"},height:{type:"number",description:"è§†å£é«˜åº¦ï¼ˆåƒç´ ï¼‰"}},required:["width","height"]},execute:async r=>{try{const[c]=await chrome.tabs.query({active:!0,currentWindow:!0});return c!=null&&c.windowId?(await chrome.windows.update(c.windowId,{width:r.width,height:r.height}),{success:!0,message:`è§†å£å·²è®¾ç½®ä¸º ${r.width}x${r.height}`}):{success:!1,error:"æ— æ³•èŽ·å–å½“å‰çª—å£"}}catch(c){return{success:!1,error:String(c)}}}}),this.register({name:"interceptRequest",description:"æ‹¦æˆªåŒ¹é…æŒ‡å®šæ¨¡å¼çš„ç½‘ç»œè¯·æ±‚ï¼Œå¯ä»¥é˜»æ­¢æˆ–é‡å®šå‘è¯·æ±‚ã€‚",parameters:{type:"object",properties:{action:{type:"string",enum:["add","remove","list"],description:"æ“ä½œç±»åž‹: add(æ·»åŠ è§„åˆ™), remove(ç§»é™¤è§„åˆ™), list(åˆ—å‡ºè§„åˆ™)"},ruleId:{type:"number",description:"è§„åˆ™IDï¼ˆremoveæ—¶å¿…éœ€ï¼‰"},urlPattern:{type:"string",description:"URLåŒ¹é…æ¨¡å¼ï¼ˆaddæ—¶å¿…éœ€ï¼‰"},interceptAction:{type:"string",enum:["block","redirect"],description:"æ‹¦æˆªæ“ä½œ: block(é˜»æ­¢), redirect(é‡å®šå‘)"},redirectUrl:{type:"string",description:"é‡å®šå‘URLï¼ˆinterceptAction=redirectæ—¶å¿…éœ€ï¼‰"},resourceTypes:{type:"array",description:"è¦æ‹¦æˆªçš„èµ„æºç±»åž‹",items:{type:"string",enum:["main_frame","sub_frame","stylesheet","script","image","font","object","xmlhttprequest","ping","media","websocket","other"]}}},required:["action"]},execute:async r=>{try{if(r.action==="list")return{success:!0,rules:await chrome.declarativeNetRequest.getDynamicRules()};if(r.action==="remove")return r.ruleId?(await chrome.declarativeNetRequest.updateDynamicRules({removeRuleIds:[r.ruleId]}),{success:!0,message:`å·²ç§»é™¤è§„åˆ™ ${r.ruleId}`}):{success:!1,error:"ç§»é™¤è§„åˆ™éœ€è¦æä¾›ruleId"};if(r.action==="add"){if(!r.urlPattern)return{success:!1,error:"æ·»åŠ è§„åˆ™éœ€è¦æä¾›urlPattern"};const c=Date.now()%1e6,m={id:c,priority:1,condition:{urlFilter:r.urlPattern,resourceTypes:r.resourceTypes||["main_frame","sub_frame","script","xmlhttprequest"]},action:r.interceptAction==="redirect"&&r.redirectUrl?{type:"redirect",redirect:{url:r.redirectUrl}}:{type:"block"}};return await chrome.declarativeNetRequest.updateDynamicRules({addRules:[m]}),{success:!0,ruleId:c,message:"å·²æ·»åŠ æ‹¦æˆªè§„åˆ™"}}return{success:!1,error:"æœªçŸ¥æ“ä½œ"}}catch(c){return{success:!1,error:String(c)}}}}),this.register({name:"request_more_elements",description:"å½“å‰é¡µé¢å…ƒç´ ä¿¡æ¯ä¸è¶³ä»¥å®Œæˆç”¨æˆ·è¯·æ±‚æ—¶ï¼Œè¯·æ±‚ç‰¹å®šåŒºåŸŸæˆ–ç±»åž‹çš„æ›´å¤šå…ƒç´ ã€‚",parameters:{type:"object",properties:{region:{type:"string",enum:["form","header","sidebar","footer","below_viewport","tab_panel","modal","menu"],description:"é¡µé¢åŒºåŸŸ: form(è¡¨å•åŒºåŸŸ), header(é¡µå¤´), sidebar(ä¾§è¾¹æ ), footer(é¡µè„š), below_viewport(è§†å£ä¸‹æ–¹), tab_panel(Tabé¢æ¿å†…), modal(å¼¹çª—/æ¨¡æ€æ¡†å†…), menu(èœå•åŒºåŸŸå†…)"},elementType:{type:"string",enum:["input","button","link","select","tab","menu","list","radio","checkbox","all"],description:"å…ƒç´ ç±»åž‹: input(è¾“å…¥æ¡†), button(æŒ‰é’®), link(é“¾æŽ¥), select(ä¸‹æ‹‰æ¡†), tab(Tabé¡µç­¾), menu(èœå•é¡¹), list(åˆ—è¡¨é¡¹), radio(å•é€‰æ¡†), checkbox(å¤é€‰æ¡†), all(æ‰€æœ‰)"},keyword:{type:"string",description:"å…³é”®è¯ç­›é€‰ï¼ŒåŒ¹é…å…ƒç´ çš„æ–‡æœ¬ã€placeholderã€labelç­‰"}}},execute:async(r,c)=>{const m=await chrome.tabs.sendMessage(c,{type:"REQUEST_MORE_ELEMENTS",payload:r});return{success:!0,elements:(m==null?void 0:m.data)||[]}}}),this.register({name:"get_selected_text",description:"èŽ·å–ç”¨æˆ·åœ¨é¡µé¢ä¸Šé€‰ä¸­çš„æ–‡å­—ï¼Œç”¨äºŽå¯¹é€‰ä¸­å†…å®¹è¿›è¡Œæ“ä½œã€‚",parameters:{type:"object",properties:{}},execute:async(r,c)=>{const m=await chrome.tabs.sendMessage(c,{type:"GET_SELECTED_TEXT"});return{success:!0,text:(m==null?void 0:m.data)||""}}}),this.register({name:"clear_ai_styles",description:"æ¸…é™¤ AI åœ¨é¡µé¢ä¸Šæ·»åŠ çš„æ‰€æœ‰é«˜äº®å’Œä¸‹åˆ’çº¿æ ·å¼ï¼Œæ¢å¤é¡µé¢åŽŸå§‹çŠ¶æ€ã€‚",parameters:{type:"object",properties:{}},execute:async(r,c)=>{const m=await chrome.tabs.sendMessage(c,{type:"CLEAR_AI_STYLES"});return{success:(m==null?void 0:m.success)||!1}}}),this.register({name:"summarize_page",description:"æå–å¹¶æ€»ç»“å½“å‰é¡µé¢çš„ä¸»è¦å†…å®¹ï¼ŒåŒ…æ‹¬æ ‡é¢˜ã€æ­£æ–‡ã€æ‘˜è¦ç­‰ã€‚é€‚ç”¨äºŽéœ€è¦ç†è§£é¡µé¢æ•´ä½“å†…å®¹çš„åœºæ™¯ã€‚",parameters:{type:"object",properties:{includeStructuredData:{type:"boolean",description:"æ˜¯å¦åŒ…å«ç»“æž„åŒ–æ•°æ®ï¼ˆJSON-LD, Microdataï¼‰"},includeMetadata:{type:"boolean",description:"æ˜¯å¦åŒ…å«é¡µé¢å…ƒæ•°æ®ï¼ˆmetaæ ‡ç­¾ï¼‰"}}},execute:async(r,c)=>{const m=await chrome.tabs.sendMessage(c,{type:"SUMMARIZE_PAGE",payload:r});return(m==null?void 0:m.data)||{success:!1,error:"é¡µé¢æ€»ç»“å¤±è´¥"}}}),this.register({name:"extract_data",description:"ä»Žé¡µé¢ä¸­æå–ç»“æž„åŒ–æ•°æ®ï¼Œæ”¯æŒè¡¨æ ¼ã€åˆ—è¡¨ã€å¡ç‰‡ç­‰å¤šç§æ ¼å¼ã€‚å¯ä»¥æå–äº§å“ä¿¡æ¯ã€æ–‡ç« åˆ—è¡¨ã€æœç´¢ç»“æžœç­‰ã€‚",parameters:{type:"object",properties:{selector:{type:"string",description:"CSSé€‰æ‹©å™¨ï¼ŒæŒ‡å®šè¦æå–çš„åŒºåŸŸï¼ˆå¯é€‰ï¼‰"},dataType:{type:"string",enum:["table","list","cards","form","all"],description:"æ•°æ®ç±»åž‹: table(è¡¨æ ¼), list(åˆ—è¡¨), cards(å¡ç‰‡), form(è¡¨å•), all(æ‰€æœ‰)"},fields:{type:"array",description:"è¦æå–çš„å­—æ®µååˆ—è¡¨ï¼ˆå¯é€‰ï¼Œç”¨äºŽè¡¨æ ¼ï¼‰",items:{type:"string"}}}},execute:async(r,c)=>{const m=await chrome.tabs.sendMessage(c,{type:"EXTRACT_DATA",payload:r});return(m==null?void 0:m.data)||{success:!1,error:"æ•°æ®æå–å¤±è´¥"}}})}register(r){this.tools.set(r.name,r)}unregister(r){this.tools.delete(r)}isBrowserTool(r){return this.tools.has(r)}getToolNames(){return Array.from(this.tools.keys())}getToolDefinitions(){return Array.from(this.tools.values()).map(r=>{var c,m,k,a,y;if(r.name==="page_action"){const N=JSON.parse(JSON.stringify(r.parameters)),D=(y=(a=(k=(m=(c=N.properties)==null?void 0:c.actions)==null?void 0:m.items)==null?void 0:k.properties)==null?void 0:a.action)==null?void 0:y.enum;if(D){N.properties.actions.items.properties.action.enum=D.filter(b=>b!=="click");const _=N.properties.actions.items.properties.action.description;_&&(N.properties.actions.items.properties.action.description=_.replace(/, click\(ç‚¹å‡»\)/,"").replace(/click\(ç‚¹å‡»\), /,""))}return{name:r.name,description:r.description,parameters:N}}return{name:r.name,description:r.description,parameters:r.parameters}})}async execute(r,c){const m=this.tools.get(r);if(!m)return JSON.stringify({success:!1,error:`æœªçŸ¥çš„æµè§ˆå™¨å·¥å…·: ${r}`});try{const[k]=await chrome.tabs.query({active:!0,currentWindow:!0});if(!(k!=null&&k.id))return JSON.stringify({success:!1,error:"æ— æ³•èŽ·å–å½“å‰æ ‡ç­¾é¡µ"});let a;try{a=JSON.parse(c)}catch{return JSON.stringify({success:!1,error:"æ— æ•ˆçš„å‚æ•°æ ¼å¼"})}const y=await m.execute(a,k.id);return JSON.stringify(y)}catch(k){return console.error(`æ‰§è¡Œå·¥å…· ${r} å¤±è´¥:`,k),JSON.stringify({success:!1,error:String(k)})}}}const Z=new vt,mt={class:"chat-wrapper"},gt={class:"chat-container"},yt={class:"chat-header"},ft={class:"header-left"},ht={class:"header-title"},kt={class:"header-badges"},wt=["title"],bt={class:"header-right"},_t={key:0,class:"session-dropdown-menu"},xt={class:"session-dropdown-header"},Ct={class:"session-dropdown-list"},St={key:0,class:"session-dropdown-loading"},Tt={key:1,class:"session-dropdown-empty"},It=["onClick"],Mt={class:"session-dropdown-info"},At={class:"session-dropdown-title"},Lt={class:"session-dropdown-meta"},Et={key:0,class:"session-url"},Nt={class:"session-time"},jt={class:"session-dropdown-actions"},Dt=["onClick"],Bt=["onClick"],Pt=["onClick"],Rt={key:0,class:"session-check"},$t={class:"modal-body"},qt={class:"modal-body"},Ot={key:0,class:"empty-state"},Ut={class:"message-box user-box"},Ht={class:"message-time"},Jt={class:"assistant-content"},Vt={key:0,class:"think-block"},zt={class:"think-content"},Gt={key:0,class:"message-box assistant-box"},Ft={class:"block-content"},Xt={key:1,class:"tool-block"},Kt={class:"tool-header"},Wt={class:"tool-name"},Yt={key:0,class:"tool-badge approved"},Qt={key:1,class:"tool-badge rejected"},Zt={class:"tool-params-container"},es=["innerHTML"],ts={key:0,class:"tool-actions"},ss=["onClick"],os=["onClick"],ns={key:2,class:"summary-block"},as={class:"summary-content"},rs={key:3,class:"question-block"},is={class:"question-content"},ls={class:"tool-result-header"},cs={class:"tool-result-icon"},us={key:0,class:"spinning",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",width:"16",height:"16"},ds={key:1,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",width:"16",height:"16"},ps={key:2,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",width:"16",height:"16"},vs={class:"tool-result-name"},ms={class:"tool-result-status"},gs={class:"tool-result-content"},ys={key:5,class:"image-block"},fs={class:"image-container"},hs=["src","alt"],ks={class:"image-actions"},ws=["onClick"],bs={class:"message-time"},_s={key:1,class:"message assistant"},xs={key:2,class:"token-stats-bar"},Cs={class:"token-stats-content"},Ss={class:"token-stats-info"},Ts={class:"token-used"},Is={class:"token-limit"},Ms={key:0,class:"token-warning-text"},As={class:"token-progress-bar"},Ls={class:"chat-input-area"},Es={key:0,class:"agent-selected-indicator"},Ns={key:0,class:"agent-dropdown-menu"},js={class:"agent-dropdown-header"},Ds={class:"agent-dropdown-list"},Bs={key:0,class:"agent-dropdown-loading"},Ps={key:1,class:"agent-dropdown-empty"},Rs=["onClick"],$s={class:"agent-dropdown-info"},qs={class:"agent-dropdown-name"},Os={key:0,class:"recommended-tag"},Us={class:"agent-dropdown-desc"},Hs={key:0,class:"agent-check"},Js=["onKeydown"],Vs=["disabled"],ge=2e5,zs=lt({__name:"App",setup(z){const r=f(),c=f(),m=f(""),k=f(!1),a=f([]),y=f(1),N=f(!1),D=f([]),_=f(null),b=f(!1),U=f(""),ne=f(!1),ee=f(null),E=f(""),R=f(""),Q=f([]),G=f(!1),ae=f(!1),H=f({total:0,prompt:0,completion:0}),te=me(()=>H.value.total/ge*100),re=o=>o>=1e6?(o/1e6).toFixed(1)+"M":o>=1e3?(o/1e3).toFixed(1)+"K":o.toString(),F=f("gpt-3.5-turbo"),h=f(""),S=f(!1),X=f(null),Te=f(null),ie=me(()=>window.self!==window.top),ye=me(()=>{if(!U.value)return D.value;const o=U.value.toLowerCase();return D.value.filter(e=>{var s;return e.name.toLowerCase().includes(o)||e.description.toLowerCase().includes(o)||((s=e.tags)==null?void 0:s.some(n=>n.toLowerCase().includes(o)))})});ct(async()=>{const o=new URLSearchParams(window.location.search),e=o.get("sessionId");e&&(y.value=parseInt(e));const s=o.get("pageUrl"),n=o.get("pageTitle");s&&(E.value=decodeURIComponent(s)),n&&(R.value=decodeURIComponent(n)),await he(),await fe(),await Ie(),L(()=>{var i;(i=c.value)==null||i.focus()}),window.addEventListener("message",i=>{i.data.type==="PIN_STATUS_CHANGED"&&(N.value=i.data.isPinned),i.data.type==="PAGE_INFO"&&(E.value=i.data.url,R.value=i.data.title,fe())}),document.addEventListener("click",i=>{const u=i.target;u.closest(".agent-selector")||(b.value=!1),u.closest(".session-selector")||(G.value=!1)})});const fe=async()=>{ne.value=!0;try{const o=await chrome.runtime.sendMessage({type:"GET_AGENTS",payload:{userId:"default_user"}});if(o.success&&o.data){if(D.value=o.data.agents||[],ee.value=o.data.recommended||null,ee.value&&!_.value){const e=D.value.find(s=>s.id===ee.value);e&&(_.value=e)}!_.value&&D.value.length>0&&(_.value=D.value[0])}}catch(o){console.error("åŠ è½½ Agent åˆ—è¡¨å¤±è´¥:",o)}finally{ne.value=!1}},Ie=async()=>{try{const o=await chrome.runtime.sendMessage({type:"GET_SETTING",payload:{key:"model"}});o!=null&&o.success&&o.data?F.value=o.data:F.value="gpt-3.5-turbo"}catch(o){console.error("åŠ è½½æ¨¡åž‹è®¾ç½®å¤±è´¥:",o),F.value="gpt-3.5-turbo"}},Me=()=>{b.value=!b.value,b.value&&(U.value="")},Ae=o=>{_.value=o,b.value=!1},Le=async()=>{G.value=!G.value,G.value&&await Ee()},Ee=async()=>{ae.value=!0;try{const o=await chrome.runtime.sendMessage({type:"GET_SESSIONS"});o.success&&(Q.value=(o.data||[]).sort((e,s)=>s.updatedAt-e.updatedAt))}catch(o){console.error("åŠ è½½ä¼šè¯åˆ—è¡¨å¤±è´¥:",o)}finally{ae.value=!1}},Ne=async o=>{y.value=o.id,G.value=!1,o.pageUrl&&(E.value=o.pageUrl),o.pageTitle&&(R.value=o.pageTitle),await he()},je=o=>{try{return new URL(o).hostname}catch{return o}},De=o=>{const s=Date.now()-o,n=Math.floor(s/6e4),i=Math.floor(s/36e5),u=Math.floor(s/864e5);return n<1?"åˆšåˆš":n<60?`${n}åˆ†é’Ÿå‰`:i<24?`${i}å°æ—¶å‰`:u<7?`${u}å¤©å‰`:new Date(o).toLocaleDateString("zh-CN")},he=async()=>{const o=await chrome.runtime.sendMessage({type:"GET_MESSAGES",payload:{sessionId:y.value}});o.success&&(a.value=o.data.map(e=>({...e,blocks:e.blocks||[{type:"text",text:e.content}]})),L(j))},Be=o=>o.blocks.filter(s=>s.type==="text").map(s=>s.text).join(""),Pe=o=>JSON.stringify(o,null,2).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?)/g,s=>{let n="json-string";return/:$/.test(s)?(n="json-key",s=s.replace(/:$/,""),`<span class="${n}">${s}</span>:`):`<span class="${n}">${s}</span>`}).replace(/\b(true|false)\b/g,'<span class="json-boolean">$1</span>').replace(/\b(null)\b/g,'<span class="json-null">$1</span>').replace(/\b(-?\d+\.?\d*)\b/g,'<span class="json-number">$1</span>'),Re=o=>{const e=o.currentTarget,s=e.parentElement,n=s==null?void 0:s.querySelector(".tool-params"),i=e.querySelector(".collapse-icon");n&&i&&(n.classList.toggle("collapsed"),i.classList.toggle("rotated"))},se=async(o="")=>{var e,s,n,i;if(!ie.value)return console.log("[getPageContext] èŠå¤©çª—å£ä¸åœ¨ iframe ä¸­ï¼Œä½¿ç”¨å·²ä¿å­˜çš„é¡µé¢ä¿¡æ¯"),E.value?{url:E.value,title:R.value||"",elements:[]}:(console.warn("[getPageContext] æ²¡æœ‰å¯ç”¨çš„é¡µé¢ä¿¡æ¯"),null);try{const[u]=await chrome.tabs.query({active:!0,currentWindow:!0});if(!(u!=null&&u.id))return console.warn("[getPageContext] æ— æ³•èŽ·å–æ´»åŠ¨æ ‡ç­¾é¡µ"),E.value?{url:E.value,title:R.value||"",elements:[]}:null;console.log("[getPageContext] å°è¯•èŽ·å–é¡µé¢ä¸Šä¸‹æ–‡ï¼Œæ ‡ç­¾é¡µ:",u.url);let l;try{l=await chrome.tabs.sendMessage(u.id,{type:"GET_PAGE_CONTEXT",payload:{userMessage:o}})}catch(w){if((e=w==null?void 0:w.message)!=null&&e.includes("Could not establish connection")||(s=w==null?void 0:w.message)!=null&&s.includes("Receiving end does not exist")){console.log("[getPageContext] Content script æœªæ³¨å…¥ï¼Œå°è¯•æ³¨å…¥...");try{await chrome.scripting.executeScript({target:{tabId:u.id},files:["content.js"]}),await chrome.scripting.insertCSS({target:{tabId:u.id},files:["content.css"]}),await new Promise(g=>setTimeout(g,200)),l=await chrome.tabs.sendMessage(u.id,{type:"GET_PAGE_CONTEXT",payload:{userMessage:o}})}catch(g){return console.error("[getPageContext] æ³¨å…¥ content script å¤±è´¥:",g),E.value?{url:E.value,title:R.value||"",elements:[]}:null}}else throw w}return l?l.success?(console.log("[getPageContext] æˆåŠŸèŽ·å–é¡µé¢ä¸Šä¸‹æ–‡ï¼Œå…ƒç´ æ•°é‡:",((i=(n=l.data)==null?void 0:n.elements)==null?void 0:i.length)||0),Te.value=l.data,l.data):(console.warn("[getPageContext] Content script è¿”å›žå¤±è´¥:",l),E.value?{url:E.value,title:R.value||"",elements:[]}:null):(console.warn("[getPageContext] Content script è¿”å›ž undefinedï¼Œå¯èƒ½æœªæ­£ç¡®å“åº”"),E.value?{url:E.value,title:R.value||"",elements:[]}:null)}catch(u){if(console.error("[getPageContext] èŽ·å–é¡µé¢ä¸Šä¸‹æ–‡å¤±è´¥:",u),E.value)return{url:E.value,title:R.value||"",elements:[]}}return null},$e=async(o,e)=>await Z.execute(o,e),qe=(o,e)=>{const s=document.createElement("a");s.href=o,s.download=`screenshot_${Date.now()}.png`,document.body.appendChild(s),s.click(),document.body.removeChild(s)},Oe=async(o,e)=>{var u;const s={sessionId:y.value,role:"assistant",blocks:[{type:"text",text:`âœ… ${e.message||"æˆªå›¾å·²ä¿å­˜åˆ°å‰ªè´´æ¿ï¼Œä½ å¯ä»¥ç›´æŽ¥ç²˜è´´ä½¿ç”¨ï¼ˆCtrl+V/Cmd+Vï¼‰"}`},{type:"image",url:e.data,alt:"é¡µé¢æˆªå›¾"}],createdAt:Date.now()};a.value.push(s),L(j);const n=()=>{const l=document.createElement("a");l.href=e.data,l.download=`screenshot_${Date.now()}.png`,document.body.appendChild(l),l.click(),document.body.removeChild(l)};s.downloadImage=n;const i={success:!0,message:e.message,clipboardSaved:e.clipboardSaved,autoDownload:e.autoDownload,imageDataLength:((u=e.data)==null?void 0:u.length)||0};await ke(o,JSON.stringify(i),e.message)},ke=async(o,e,s)=>{var V;let n=!0;try{n=JSON.parse(e).success!==!1}catch{}const i={sessionId:y.value,role:"assistant",blocks:[{type:"tool_result",toolName:o,success:n,result:s}],createdAt:Date.now()};a.value.push(i),L(j),S.value=!0,h.value="";const u={sessionId:y.value,role:"assistant",blocks:[{type:"text",text:""}],createdAt:Date.now()};a.value.push(u);const l=a.value.length-1;let w="",g=null,M=null;try{const T=await se(),q=chrome.runtime.connect({name:"chat-stream"});q.onMessage.addListener(async B=>{var d,A;if(B.type==="data"){const x=B.data;if(M=x,x.content){h.value+=x.content;const W=a.value[l].blocks.find(at=>at.type==="text");W&&W.type==="text"&&(W.text=h.value),L(j)}if(x.think&&x.think.reasoning_content&&(w=x.think.reasoning_content),x.toolCall&&x.toolCall.tool_name)try{g={type:"tool_use",id:`tool_${Date.now()}`,name:x.toolCall.tool_name,input:JSON.parse(x.toolCall.arguments||"{}"),status:"pending"}}catch(W){console.error("è§£æžå·¥å…·å‚æ•°å¤±è´¥:",W)}x.statistic&&x.statistic.token_usage&&(H.value={total:x.statistic.token_usage.total_tokens||0,prompt:x.statistic.token_usage.prompt_tokens||0,completion:x.statistic.token_usage.completion_tokens||0})}else if(B.type==="done")S.value=!1,a.value[l].blocks=[],w&&(a.value[l].think=w),g?(a.value[l].blocks.push(g),a.value[l].isComplete=!1):(d=M==null?void 0:M.answer)!=null&&d.result?(a.value[l].blocks.push({type:"summary",text:M.answer.result}),a.value[l].isComplete=!0):(A=M==null?void 0:M.ask)!=null&&A.question?(a.value[l].blocks.push({type:"question",text:M.ask.question}),a.value[l].isComplete=!0):(h.value&&a.value[l].blocks.push({type:"text",text:h.value}),a.value[l].isComplete=!0),q.disconnect(),L(j);else if(B.type==="error"){console.error("æµå¼å“åº”é”™è¯¯:",B.error);const x=a.value[l].blocks.find(W=>W.type==="text");x&&x.type==="text"&&(x.text=`é”™è¯¯: ${B.error}`),S.value=!1,q.disconnect()}}),q.postMessage({agentId:((V=_.value)==null?void 0:V.id)||"",sessionId:y.value,message:`æµè§ˆå™¨å·¥å…· ${o} æ‰§è¡Œç»“æžœ: ${e}`,model:F.value,userId:"default_user",role:"user",currentPageInfo:T,browserTools:Z.getToolDefinitions()})}catch(T){console.error("å‘é€å·¥å…·ç»“æžœå¤±è´¥:",T),S.value=!1}},we=async()=>{if(!m.value.trim()||k.value||S.value)return;let o=m.value.trim();m.value="";const e=Ue();e&&(He(),o=`[ç”¨æˆ·æ‹’ç»äº†å·¥å…· "${e.toolName}" çš„æ‰§è¡Œï¼Œå¹¶å‘é€äº†æ–°æŒ‡ä»¤]

${o}`);const s={sessionId:y.value,role:"user",blocks:[{type:"text",text:o}],createdAt:Date.now()};a.value.push(s),L(j),_.value&&_.value.id?await Je(o):await ze(o)},Ue=()=>{if(a.value.length===0)return null;const o=a.value[a.value.length-1];if(o.role!=="assistant")return null;const e=o.blocks.find(s=>s.type==="tool_use"&&s.status==="pending");return e?{toolName:e.name,toolId:e.id}:null},He=()=>{if(a.value.length===0)return;const o=a.value[a.value.length-1];o.role==="assistant"&&(o.blocks.forEach(e=>{e.type==="tool_use"&&e.status==="pending"&&(e.status="rejected")}),o.isComplete=!0)},Je=async o=>{S.value=!0,h.value="";const e={sessionId:y.value,role:"assistant",blocks:[{type:"text",text:""}],createdAt:Date.now()};a.value.push(e);const s=a.value.length-1;let n=null;try{const i=chrome.runtime.connect({name:"chat-stream"});X.value=i,i.onMessage.addListener(w=>{if(console.log("[Chat Stream] æ”¶åˆ°æ¶ˆæ¯:",w),w.type==="data"){const g=w.data;if(console.log("[Chat Stream] data å†…å®¹:",g),n=g,g.content){h.value+=g.content;const M=a.value[s].blocks.find(V=>V.type==="text");M&&M.type==="text"&&(M.text=h.value),L(j)}g.statistic&&g.statistic.token_usage&&(H.value={total:g.statistic.token_usage.total_tokens||0,prompt:g.statistic.token_usage.prompt_tokens||0,completion:g.statistic.token_usage.completion_tokens||0})}else if(w.type==="done"){if(console.log("[Chat Stream] æµå¼ä¼ è¾“å®Œæˆ, lastCompleteMessage:",n),S.value=!1,a.value[s].blocks=[],n)if(n.think&&n.think.reasoning_content&&(a.value[s].think=n.think.reasoning_content),n.toolCall&&n.toolCall.tool_name)try{const g={type:"tool_use",id:`tool_${Date.now()}`,name:n.toolCall.tool_name,input:JSON.parse(n.toolCall.arguments||"{}"),status:"pending"};a.value[s].blocks.push(g),a.value[s].isComplete=!1}catch(g){console.error("è§£æžå·¥å…·å‚æ•°å¤±è´¥:",g)}else n.answer&&n.answer.result?(a.value[s].blocks.push({type:"summary",text:n.answer.result}),a.value[s].isComplete=!0):n.ask&&n.ask.question?(a.value[s].blocks.push({type:"question",text:n.ask.question}),a.value[s].isComplete=!0):(!n.think&&h.value&&a.value[s].blocks.push({type:"text",text:h.value}),a.value[s].isComplete=!0);else h.value&&a.value[s].blocks.push({type:"text",text:h.value}),a.value[s].isComplete=!0;i.disconnect(),X.value=null,L(j)}else if(w.type==="error"){console.error("æµå¼å“åº”é”™è¯¯:",w.error);const g=a.value[s].blocks.find(M=>M.type==="text");g&&g.type==="text"&&(g.text=`é”™è¯¯: ${w.error}`),S.value=!1,i.disconnect(),X.value=null}});const u=await se(o),l=Z.getToolDefinitions();i.postMessage({agentId:_.value.id,sessionId:y.value,message:o,model:F.value,userId:"default_user",role:"user",currentPageInfo:u,browserTools:l})}catch(i){console.error("å‘é€æµå¼æ¶ˆæ¯å¤±è´¥:",i);const u=a.value[s].blocks.find(l=>l.type==="text");u&&u.type==="text"&&(u.text=`å‘é€å¤±è´¥: ${i}`),S.value=!1,X.value=null}},Ve=()=>{if(X.value&&(X.value.disconnect(),X.value=null),S.value=!1,a.value.length>0){const o=a.value[a.value.length-1];if(o.role==="assistant"){if(h.value){const e=o.blocks.find(s=>s.type==="text");e&&e.type==="text"?e.text=h.value+" [å·²åœæ­¢]":o.blocks.length===0&&o.blocks.push({type:"text",text:h.value+" [å·²åœæ­¢]"})}o.isComplete=!0}}},ze=async o=>{k.value=!0;try{const e=await chrome.runtime.sendMessage({type:"SEND_MESSAGE",payload:{sessionId:y.value,content:o}});if(e.success){const s={sessionId:y.value,role:"assistant",blocks:e.blocks||[{type:"text",text:e.response}],createdAt:Date.now(),isComplete:e.isComplete!==!1};a.value.push(s),L(j)}}catch(e){console.error("å‘é€æ¶ˆæ¯å¤±è´¥:",e)}finally{k.value=!1}},be=async(o,e)=>{const s=a.value[a.value.length-1];let n;s&&s.role==="assistant"&&(n=s.blocks.find(i=>i.type==="tool_use"&&i.id===o),n&&(n.status=e?"approved":"rejected")),e&&(n&&Z.isBrowserTool(n.name)?await Ge(n):await Fe(o))},Ge=async o=>{const e=await $e(o.name,JSON.stringify(o.input));let s={};try{s=JSON.parse(e)}catch{s={success:!1,error:e}}if(o.name==="screenshot"&&s.success&&s.data){await Oe(o.name,s);return}const n=s.summary||s.message||(s.success?"æ‰§è¡ŒæˆåŠŸ":"æ‰§è¡Œå¤±è´¥");await ke(o.name,e,n)},Fe=async o=>{var w;S.value=!0,h.value="";const e={sessionId:y.value,role:"assistant",blocks:[{type:"text",text:""}],createdAt:Date.now()};a.value.push(e);const s=a.value.length-1;let n="",i=null,u="",l=null;try{const g=chrome.runtime.connect({name:"chat-stream"});g.onMessage.addListener(async T=>{var q,B;if(console.log("[NonBrowserTool] æ”¶åˆ°æ¶ˆæ¯:",T),T.type==="data"){const d=T.data;if(l=d,console.log("[NonBrowserTool] data å†…å®¹:",JSON.stringify(d)),d.role==="tool"){u+=d.content||"",console.log("[NonBrowserTool] æ”¶é›†å·¥å…·æ‰§è¡Œç»“æžœ:",u),a.value[s].blocks=[{type:"tool_result",toolName:(i==null?void 0:i.name)||"å·¥å…·",success:!0,result:u.substring(0,100)+(u.length>100?"...":""),isLoading:!0}],L(j);return}if(d.content){h.value+=d.content;const A=a.value[s].blocks.find(x=>x.type==="text");A&&A.type==="text"&&(A.text=h.value),L(j)}if(d.think&&d.think.reasoning_content&&(n+=d.think.reasoning_content),d.toolCall&&d.toolCall.tool_name)try{i={type:"tool_use",id:`tool_${Date.now()}`,name:d.toolCall.tool_name,input:JSON.parse(d.toolCall.arguments||"{}"),status:"pending"}}catch(A){console.error("è§£æžå·¥å…·å‚æ•°å¤±è´¥:",A)}d.statistic&&d.statistic.token_usage&&(H.value={total:d.statistic.token_usage.total_tokens||0,prompt:d.statistic.token_usage.prompt_tokens||0,completion:d.statistic.token_usage.completion_tokens||0})}else if(T.type==="done"){if(console.log("[NonBrowserTool] æµå¼ä¼ è¾“å®Œæˆ"),console.log("[NonBrowserTool] toolResultContent:",u),g.disconnect(),u){console.log("[NonBrowserTool] æ£€æµ‹åˆ°å·¥å…·ç»“æžœï¼Œç»§ç»­å‘é€è¯·æ±‚..."),a.value[s].blocks=[{type:"tool_result",toolName:(i==null?void 0:i.name)||"å·¥å…·",success:!0,result:u.substring(0,200)+(u.length>200?"...":""),isLoading:!1}],a.value[s].isComplete=!0,L(j),await Xe(o,u);return}S.value=!1,a.value[s].blocks=[],n&&(a.value[s].think=n),i?(a.value[s].blocks.push(i),a.value[s].isComplete=!1):(q=l==null?void 0:l.answer)!=null&&q.result?(a.value[s].blocks.push({type:"summary",text:l.answer.result}),a.value[s].isComplete=!0):(B=l==null?void 0:l.ask)!=null&&B.question?(a.value[s].blocks.push({type:"question",text:l.ask.question}),a.value[s].isComplete=!0):(!n&&h.value&&a.value[s].blocks.push({type:"text",text:h.value}),a.value[s].isComplete=!0),L(j)}else if(T.type==="error"){console.error("æµå¼å“åº”é”™è¯¯:",T.error);const d=a.value[s].blocks.find(A=>A.type==="text");d&&d.type==="text"&&(d.text=`é”™è¯¯: ${T.error}`),S.value=!1,g.disconnect()}});const M=await se(),V=Z.getToolDefinitions();g.postMessage({agentId:((w=_.value)==null?void 0:w.id)||"",sessionId:y.value,message:JSON.stringify({toolId:o,approved:!0}),model:F.value,userId:"default_user",role:"function",currentPageInfo:M,browserTools:V})}catch(g){console.error("å¤„ç†å·¥å…·å“åº”å¤±è´¥:",g),S.value=!1}},Xe=async(o,e)=>{var w;h.value="";const s={sessionId:y.value,role:"assistant",blocks:[{type:"text",text:""}],createdAt:Date.now()};a.value.push(s);const n=a.value.length-1;let i="",u=null,l=null;try{const g=chrome.runtime.connect({name:"chat-stream"});g.onMessage.addListener(T=>{var q,B;if(console.log("[SendToolResult] æ”¶åˆ°æ¶ˆæ¯:",T),T.type==="data"){const d=T.data;if(l=d,console.log("[SendToolResult] data å†…å®¹:",d),d.content){h.value+=d.content;const A=a.value[n].blocks.find(x=>x.type==="text");A&&A.type==="text"&&(A.text=h.value),L(j)}if(d.think&&d.think.reasoning_content&&(i+=d.think.reasoning_content),d.toolCall&&d.toolCall.tool_name)try{u={type:"tool_use",id:`tool_${Date.now()}`,name:d.toolCall.tool_name,input:JSON.parse(d.toolCall.arguments||"{}"),status:"pending"}}catch(A){console.error("è§£æžå·¥å…·å‚æ•°å¤±è´¥:",A)}d.statistic&&d.statistic.token_usage&&(H.value={total:d.statistic.token_usage.total_tokens||0,prompt:d.statistic.token_usage.prompt_tokens||0,completion:d.statistic.token_usage.completion_tokens||0})}else if(T.type==="done")console.log("[SendToolResult] æµå¼ä¼ è¾“å®Œæˆ"),S.value=!1,a.value[n].blocks=[],i&&(a.value[n].think=i),u?(a.value[n].blocks.push(u),a.value[n].isComplete=!1):(q=l==null?void 0:l.answer)!=null&&q.result?(a.value[n].blocks.push({type:"summary",text:l.answer.result}),a.value[n].isComplete=!0):(B=l==null?void 0:l.ask)!=null&&B.question?(a.value[n].blocks.push({type:"question",text:l.ask.question}),a.value[n].isComplete=!0):(!i&&h.value&&a.value[n].blocks.push({type:"text",text:h.value}),a.value[n].isComplete=!0),g.disconnect(),L(j);else if(T.type==="error"){console.error("æµå¼å“åº”é”™è¯¯:",T.error);const d=a.value[n].blocks.find(A=>A.type==="text");d&&d.type==="text"&&(d.text=`é”™è¯¯: ${T.error}`),S.value=!1,g.disconnect()}});const M=await se(),V=Z.getToolDefinitions();g.postMessage({agentId:((w=_.value)==null?void 0:w.id)||"",sessionId:y.value,message:"",model:F.value,userId:"default_user",role:"user",currentPageInfo:M,browserTools:V})}catch(g){console.error("å‘é€å·¥å…·ç»“æžœå¤±è´¥:",g),S.value=!1}},j=()=>{r.value&&(r.value.scrollTop=r.value.scrollHeight)},_e=o=>new Date(o).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),Ke=()=>{console.log("togglePin clicked, current isPinned:",N.value),window.parent&&window.parent!==window?(console.log("Sending PIN_CHAT message to parent"),window.parent.postMessage({type:"PIN_CHAT"},"*"),N.value=!N.value):console.log("Not in iframe, cannot pin")},We=()=>{window.parent&&window.parent!==window?window.parent.postMessage({type:"CLOSE_CHAT"},"*"):window.close()},Ye=()=>{const o=chrome.runtime.getURL(`chat.html?sessionId=${y.value}`);chrome.tabs.create({url:o}),window.parent&&window.parent.postMessage({type:"CLOSE_CHAT"},"*")},Qe=()=>{chrome.tabs.create({url:"https://github.com/anthropics/claude-code/issues"})},Ze=()=>{const o=chrome.runtime.getURL("options.html");chrome.tabs.create({url:o})},le=async()=>{try{const o=E.value,e=R.value||"æ–°å¯¹è¯",s=await chrome.runtime.sendMessage({type:"CREATE_SESSION",payload:{title:e,pageUrl:o,pageTitle:e}});s.success&&(y.value=s.data.id,a.value=[],h.value="",S.value=!1,k.value=!1,L(()=>{var n;(n=c.value)==null||n.focus()}))}catch(o){console.error("åˆ›å»ºæ–°ä¼šè¯å¤±è´¥:",o)}},K=f(null),J=f(""),et=o=>{K.value=o,J.value=o.title||o.pageTitle||"",L(()=>{const e=document.querySelector(".rename-input");e==null||e.focus(),e==null||e.select()})},xe=async()=>{if(!(!K.value||!J.value.trim()))try{await chrome.runtime.sendMessage({type:"RENAME_SESSION",payload:{sessionId:K.value.id,title:J.value.trim()}});const o=Q.value.find(e=>e.id===K.value.id);o&&(o.title=J.value.trim()),K.value=null,J.value=""}catch(o){console.error("é‡å‘½åä¼šè¯å¤±è´¥:",o)}},ce=()=>{K.value=null,J.value=""},tt=async o=>{try{const e=await chrome.runtime.sendMessage({type:"EXPORT_SESSION",payload:{sessionId:o}});if(e.success&&e.data){const s=e.data,n=`chat-session-${s.session.title||o}-${new Date().toISOString().slice(0,10)}.json`;st(s,n)}}catch(e){console.error("å¯¼å‡ºä¼šè¯å¤±è´¥:",e)}},st=(o,e)=>{const s=new Blob([JSON.stringify(o,null,2)],{type:"application/json"}),n=URL.createObjectURL(s),i=document.createElement("a");i.href=n,i.download=e,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(n)},$=f(null),ot=o=>{$.value=o},nt=async()=>{if($.value)try{await chrome.runtime.sendMessage({type:"DELETE_SESSION",payload:{sessionId:$.value.id}}),Q.value=Q.value.filter(o=>o.id!==$.value.id),y.value===$.value.id&&await le(),$.value=null}catch(o){console.error("åˆ é™¤ä¼šè¯å¤±è´¥:",o)}},Ce=()=>{$.value=null};return(o,e)=>(p(),v("div",mt,[t("div",gt,[t("div",yt,[t("div",ft,[e[8]||(e[8]=t("div",{class:"logo-icon"},[t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[t("path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})])],-1)),t("div",ht,[e[7]||(e[7]=t("h3",null,"AI Chat Assistant",-1)),t("div",kt,[_.value?(p(),v("span",{key:0,class:"agent-badge",title:_.value.name},C(_.value.name),9,wt)):I("",!0)])])]),t("div",bt,[t("div",{class:"session-selector",onClick:P(Le,["stop"])},[t("button",{class:O(["icon-btn",{active:G.value}]),title:"åˆ‡æ¢ä¼šè¯"},[...e[9]||(e[9]=[t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[t("path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)])],2),G.value?(p(),v("div",_t,[t("div",xt,[e[11]||(e[11]=t("span",null,"åŽ†å²ä¼šè¯",-1)),t("button",{class:"session-new-btn",onClick:P(le,["stop"])},[...e[10]||(e[10]=[t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[t("line",{x1:"12",y1:"5",x2:"12",y2:"19","stroke-width":"2","stroke-linecap":"round"}),t("line",{x1:"5",y1:"12",x2:"19",y2:"12","stroke-width":"2","stroke-linecap":"round"})],-1),ue(" æ–°å»º ",-1)])])]),t("div",Ct,[ae.value?(p(),v("div",St,[...e[12]||(e[12]=[t("div",{class:"loading-spinner"},null,-1),t("span",null,"åŠ è½½ä¸­...",-1)])])):Q.value.length===0?(p(),v("div",Tt," æš‚æ— åŽ†å²ä¼šè¯ ")):(p(!0),v(Y,{key:2},oe(Q.value,s=>(p(),v("div",{key:s.id,class:O(["session-dropdown-item",{selected:y.value===s.id}]),onClick:P(n=>Ne(s),["stop"])},[t("div",Mt,[t("div",At,C(s.title||s.pageTitle||"æœªå‘½åä¼šè¯"),1),t("div",Lt,[s.pageUrl?(p(),v("span",Et,C(je(s.pageUrl)),1)):I("",!0),t("span",Nt,C(De(s.updatedAt)),1)])]),t("div",jt,[t("button",{class:"session-action-btn",onClick:P(n=>et(s),["stop"]),title:"é‡å‘½å"},[...e[13]||(e[13]=[t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",width:"14",height:"14"},[t("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}),t("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)])],8,Dt),t("button",{class:"session-action-btn",onClick:P(n=>tt(s.id),["stop"]),title:"å¯¼å‡º"},[...e[14]||(e[14]=[t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",width:"14",height:"14"},[t("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}),t("polyline",{points:"7 10 12 15 17 10","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}),t("line",{x1:"12",y1:"15",x2:"12",y2:"3","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)])],8,Bt),t("button",{class:"session-action-btn delete",onClick:P(n=>ot(s),["stop"]),title:"åˆ é™¤"},[...e[15]||(e[15]=[t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",width:"14",height:"14"},[t("polyline",{points:"3 6 5 6 21 6","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}),t("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)])],8,Pt)]),y.value===s.id?(p(),v("div",Rt,[...e[16]||(e[16]=[t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[t("polyline",{points:"20 6 9 17 4 12","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)])])):I("",!0)],10,It))),128))])])):I("",!0)]),t("button",{class:"icon-btn",onClick:le,title:"æ–°å»ºä¼šè¯"},[...e[17]||(e[17]=[t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[t("line",{x1:"12",y1:"5",x2:"12",y2:"19","stroke-width":"2","stroke-linecap":"round"}),t("line",{x1:"5",y1:"12",x2:"19",y2:"12","stroke-width":"2","stroke-linecap":"round"})],-1)])]),t("button",{class:"icon-btn",onClick:Qe,title:"å¸®åŠ©æ–‡æ¡£"},[...e[18]||(e[18]=[t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[t("circle",{cx:"12",cy:"12",r:"10","stroke-width":"2"}),t("path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}),t("line",{x1:"12",y1:"17",x2:"12.01",y2:"17","stroke-width":"2","stroke-linecap":"round"})],-1)])]),t("button",{class:"icon-btn",onClick:Ze,title:"è®¾ç½®"},[...e[19]||(e[19]=[t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[t("circle",{cx:"12",cy:"12",r:"3","stroke-width":"2"}),t("path",{d:"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)])]),ie.value?(p(),v("button",{key:0,class:O(["icon-btn",{active:N.value}]),onClick:Ke,title:"å›ºå®šçª—å£"},[...e[20]||(e[20]=[t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[t("path",{d:"M16 4v8l3 3-2 2-3-3-4 4-2-2 4-4-3-3 2-2 3 3V4h2z","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)])],2)):I("",!0),ie.value?(p(),v("button",{key:1,class:"icon-btn",onClick:Ye,title:"å…¨å±æ‰“å¼€"},[...e[21]||(e[21]=[t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[t("path",{d:"M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)])])):I("",!0),t("button",{class:"icon-btn",onClick:We,title:"å…³é—­"},[...e[22]||(e[22]=[t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[t("line",{x1:"18",y1:"6",x2:"6",y2:"18","stroke-width":"2","stroke-linecap":"round"}),t("line",{x1:"6",y1:"6",x2:"18",y2:"18","stroke-width":"2","stroke-linecap":"round"})],-1)])])])]),K.value?(p(),v("div",{key:0,class:"modal-overlay",onClick:ce},[t("div",{class:"modal-dialog",onClick:e[1]||(e[1]=P(()=>{},["stop"]))},[e[23]||(e[23]=t("div",{class:"modal-header"},"é‡å‘½åä¼šè¯",-1)),t("div",$t,[de(t("input",{type:"text",class:"rename-input","onUpdate:modelValue":e[0]||(e[0]=s=>J.value=s),onKeyup:[ve(xe,["enter"]),ve(ce,["esc"])],placeholder:"è¾“å…¥æ–°åç§°"},null,544),[[pe,J.value]])]),t("div",{class:"modal-footer"},[t("button",{class:"btn btn-secondary",onClick:ce},"å–æ¶ˆ"),t("button",{class:"btn btn-primary",onClick:xe},"ç¡®å®š")])])])):I("",!0),$.value?(p(),v("div",{key:1,class:"modal-overlay",onClick:Ce},[t("div",{class:"modal-dialog",onClick:e[2]||(e[2]=P(()=>{},["stop"]))},[e[25]||(e[25]=t("div",{class:"modal-header"},"ç¡®è®¤åˆ é™¤",-1)),t("div",qt,[t("p",null,'ç¡®å®šè¦åˆ é™¤ä¼šè¯ "'+C($.value.title||$.value.pageTitle||"æœªå‘½åä¼šè¯")+'" å—ï¼Ÿ',1),e[24]||(e[24]=t("p",{class:"modal-warning"},"æ­¤æ“ä½œä¸å¯æ¢å¤",-1))]),t("div",{class:"modal-footer"},[t("button",{class:"btn btn-secondary",onClick:Ce},"å–æ¶ˆ"),t("button",{class:"btn btn-danger",onClick:nt},"åˆ é™¤")])])])):I("",!0),t("div",{class:"chat-messages",ref_key:"messagesContainer",ref:r},[a.value.length===0?(p(),v("div",Ot,[...e[26]||(e[26]=[t("p",null,"å¼€å§‹å¯¹è¯å§",-1)])])):I("",!0),(p(!0),v(Y,null,oe(a.value,s=>(p(),v("div",{key:s.id||s.createdAt,class:O(["message",s.role,"message-in"])},[s.role==="user"?(p(),v(Y,{key:0},[t("div",Ut,C(Be(s)),1),t("span",Ht,C(_e(s.createdAt)),1)],64)):(p(),v(Y,{key:1},[t("div",Jt,[s.think?(p(),v("div",Vt,[e[27]||(e[27]=t("div",{class:"think-header"},[t("span",{class:"think-icon"},"ðŸ’­"),t("span",{class:"think-label"},"æ€è€ƒè¿‡ç¨‹")],-1)),t("div",zt,C(s.think),1)])):I("",!0),(p(!0),v(Y,null,oe(s.blocks,(n,i)=>(p(),v(Y,{key:i},[n.type==="text"?(p(),v("div",Gt,[e[28]||(e[28]=t("span",{class:"block-indicator text-indicator"},"â–¶",-1)),t("span",Ft,C(n.text),1)])):n.type==="tool_use"?(p(),v("div",Xt,[t("div",Kt,[e[29]||(e[29]=t("span",{class:"block-indicator tool-indicator"},"âš™",-1)),t("span",Wt,C(n.name),1),n.status==="approved"?(p(),v("span",Yt,"å·²æ‰¹å‡†")):n.status==="rejected"?(p(),v("span",Qt,"å·²æ‹’ç»")):I("",!0)]),t("div",Zt,[t("div",{class:"tool-params-header",onClick:e[3]||(e[3]=u=>Re(u))},[...e[30]||(e[30]=[t("svg",{class:"collapse-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[t("polyline",{points:"6 9 12 15 18 9","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1),t("span",{class:"tool-params-label"},"å‚æ•°",-1)])]),t("pre",{class:O(["tool-params",{collapsed:!1}])},[t("code",{innerHTML:Pe(n.input)},null,8,es)])]),n.status==="pending"&&!k.value?(p(),v("div",ts,[t("button",{class:"btn btn-approve",onClick:u=>be(n.id,!0)},"Approve",8,ss),t("button",{class:"btn btn-reject",onClick:u=>be(n.id,!1)},"Reject",8,os)])):I("",!0)])):n.type==="summary"?(p(),v("div",ns,[e[31]||(e[31]=t("div",{class:"summary-header"},[t("span",{class:"summary-icon"},"âœ…"),t("span",{class:"summary-label"},"ä»»åŠ¡å®Œæˆ")],-1)),t("div",as,C(n.text),1)])):n.type==="question"?(p(),v("div",rs,[e[32]||(e[32]=t("div",{class:"question-header"},[t("span",{class:"question-icon"},"â“"),t("span",{class:"question-label"},"AI æƒ³é—®ä½ ")],-1)),t("div",is,C(n.text),1),e[33]||(e[33]=t("div",{class:"question-hint"},"è¯·åœ¨ä¸‹æ–¹è¾“å…¥æ¡†å›žå¤",-1))])):n.type==="tool_result"?(p(),v("div",{key:4,class:O(["tool-result-block",{success:n.success,error:!n.success,loading:n.isLoading}])},[t("div",ls,[t("span",cs,[n.isLoading?(p(),v("svg",us,[...e[34]||(e[34]=[t("path",{d:"M12 2v4m0 12v4m-8-10H2m20 0h-2m-2.93-6.07l-1.41 1.41m-9.32 9.32l-1.41 1.41m12.14 0l-1.41-1.41M6.34 6.34L4.93 4.93","stroke-width":"2","stroke-linecap":"round"},null,-1)])])):n.success?(p(),v("svg",ds,[...e[35]||(e[35]=[t("path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},null,-1),t("polyline",{points:"22 4 12 14.01 9 11.01","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},null,-1)])])):(p(),v("svg",ps,[...e[36]||(e[36]=[t("circle",{cx:"12",cy:"12",r:"10","stroke-width":"2"},null,-1),t("line",{x1:"15",y1:"9",x2:"9",y2:"15","stroke-width":"2","stroke-linecap":"round"},null,-1),t("line",{x1:"9",y1:"9",x2:"15",y2:"15","stroke-width":"2","stroke-linecap":"round"},null,-1)])]))]),t("span",vs,C(n.toolName),1),t("span",ms,C(n.isLoading?"æ‰§è¡Œä¸­...":n.success?"æˆåŠŸ":"å¤±è´¥"),1)]),t("div",gs,[t("pre",null,C(n.result),1)])],2)):n.type==="image"?(p(),v("div",ys,[t("div",fs,[t("img",{src:n.url,alt:n.alt||"å›¾ç‰‡",class:"screenshot-image"},null,8,hs),t("div",ks,[t("button",{class:"btn btn-download",onClick:u=>qe(n.url),title:"ä¸‹è½½å›¾ç‰‡"},[...e[37]||(e[37]=[t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",width:"16",height:"16"},[t("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}),t("polyline",{points:"7 10 12 15 17 10","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}),t("line",{x1:"12",y1:"15",x2:"12",y2:"3","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1),ue(" ä¸‹è½½å›¾ç‰‡ ",-1)])],8,ws),e[38]||(e[38]=t("span",{class:"image-hint"},"å·²ä¿å­˜åˆ°å‰ªè´´æ¿ï¼Œå¯ç›´æŽ¥ç²˜è´´",-1))])])])):I("",!0)],64))),128))]),t("span",bs,C(_e(s.createdAt)),1)],64))],2))),128)),k.value?(p(),v("div",_s,[...e[39]||(e[39]=[t("div",{class:"assistant-content"},[t("div",{class:"message-box assistant-box typing"},[t("span"),t("span"),t("span")])],-1)])])):I("",!0)],512),H.value.total>0||S.value?(p(),v("div",xs,[t("div",Cs,[t("div",Ss,[t("span",Ts,"å·²ç”¨ "+C(re(H.value.total)),1),e[40]||(e[40]=t("span",{class:"token-separator"},"/",-1)),t("span",Is,C(re(ge)),1),t("span",{class:O(["token-remaining",{warning:te.value>80}])}," (å‰©ä½™ "+C(re(ge-H.value.total))+") ",3)]),te.value>80?(p(),v("span",Ms,"å»ºè®®å¼€å¯æ–°ä¼šè¯")):I("",!0)]),t("div",As,[t("div",{class:O(["token-progress-fill",{warning:te.value>80,danger:te.value>95}]),style:ut({width:Math.min(te.value,100)+"%"})},null,6)])])):I("",!0),t("div",Ls,[t("div",{class:"agent-selector",onClick:Me},[t("div",{class:O(["agent-selector-btn",{active:b.value}])},[e[41]||(e[41]=t("svg",{viewBox:"0 0 24 24",fill:"currentColor"},[t("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 3c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm0 14.2c-2.5 0-4.71-1.28-6-3.22.03-1.99 4-3.08 6-3.08 1.99 0 5.97 1.09 6 3.08-1.29 1.94-3.5 3.22-6 3.22z"})],-1)),_.value?(p(),v("span",Es)):I("",!0)],2),b.value?(p(),v("div",Ns,[t("div",js,[de(t("input",{type:"text","onUpdate:modelValue":e[4]||(e[4]=s=>U.value=s),placeholder:"æœç´¢ Agent...",onClick:e[5]||(e[5]=P(()=>{},["stop"]))},null,512),[[pe,U.value]])]),t("div",Ds,[ne.value?(p(),v("div",Bs,[...e[42]||(e[42]=[t("div",{class:"loading-spinner"},null,-1),t("span",null,"åŠ è½½ä¸­...",-1)])])):ye.value.length===0?(p(),v("div",Ps," æš‚æ— å¯ç”¨ Agent ")):(p(!0),v(Y,{key:2},oe(ye.value,s=>{var n,i;return p(),v("div",{key:s.id,class:O(["agent-dropdown-item",{selected:((n=_.value)==null?void 0:n.id)===s.id,recommended:s.id===ee.value}]),onClick:P(u=>Ae(s),["stop"])},[e[44]||(e[44]=t("div",{class:"agent-dropdown-avatar"},[t("svg",{viewBox:"0 0 24 24",fill:"currentColor"},[t("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 3c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm0 14.2c-2.5 0-4.71-1.28-6-3.22.03-1.99 4-3.08 6-3.08 1.99 0 5.97 1.09 6 3.08-1.29 1.94-3.5 3.22-6 3.22z"})])],-1)),t("div",$s,[t("div",qs,[ue(C(s.name)+" ",1),s.id===ee.value?(p(),v("span",Os,"æŽ¨è")):I("",!0)]),t("div",Us,C(s.description),1)]),((i=_.value)==null?void 0:i.id)===s.id?(p(),v("div",Hs,[...e[43]||(e[43]=[t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[t("polyline",{points:"20 6 9 17 4 12","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)])])):I("",!0)],10,Rs)}),128))])])):I("",!0)]),de(t("textarea",{"onUpdate:modelValue":e[6]||(e[6]=s=>m.value=s),onKeydown:ve(P(we,["exact","prevent"]),["enter"]),placeholder:"è¾“å…¥æ¶ˆæ¯... (Enterå‘é€)",rows:"1",ref_key:"inputArea",ref:c},null,40,Js),[[pe,m.value]]),S.value?(p(),v("button",{key:0,class:"stop-btn",onClick:Ve,title:"åœæ­¢ç”Ÿæˆ"},[...e[45]||(e[45]=[t("svg",{viewBox:"0 0 24 24",fill:"currentColor"},[t("rect",{x:"6",y:"6",width:"12",height:"12",rx:"2"})],-1)])])):(p(),v("button",{key:1,class:"send-btn",onClick:we,disabled:!m.value.trim()||k.value},[...e[46]||(e[46]=[t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[t("line",{x1:"22",y1:"2",x2:"11",y2:"13","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}),t("polygon",{points:"22 2 15 22 11 13 2 9 22 2","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)])],8,Vs))])])]))}}),Gs=dt(zs,[["__scopeId","data-v-84ebda12"]]),Fs=pt(Gs);Fs.mount("#app");

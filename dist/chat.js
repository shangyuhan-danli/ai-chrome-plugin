import{d as te,f as se,m as _,o as a,c as l,b as e,t as x,g as u,n as z,F as P,r as U,a as oe,h as D,v as j,w as B,p as ne,l as r,q as G,s as ae,_ as le,e as re}from"./chunks/_plugin-vue_export-helper-C6Ao9Pha.js";const ie={class:"chat-wrapper"},de={class:"chat-container"},ce={class:"chat-header"},ue={class:"header-left"},ve={class:"header-title"},pe={key:0,class:"model-badge"},ge={class:"header-right"},we={key:0,class:"empty-state"},he={class:"message-avatar"},me={key:0,viewBox:"0 0 24 24",fill:"currentColor"},ke={key:1,viewBox:"0 0 24 24",fill:"currentColor"},fe={class:"message-content-wrapper"},ye={class:"message-content"},Ce={class:"message-time"},_e={key:1,class:"message assistant"},xe={class:"chat-input-area"},Me={key:0,class:"agent-selected-indicator"},Ae={key:0,class:"agent-dropdown-menu"},Se={class:"agent-dropdown-header"},ze={class:"agent-dropdown-list"},be={key:0,class:"agent-dropdown-loading"},Ie={key:1,class:"agent-dropdown-empty"},Te=["onClick"],Be={class:"agent-dropdown-info"},Ee={class:"agent-dropdown-name"},Le={key:0,class:"recommended-tag"},He={class:"agent-dropdown-desc"},Ne={key:0,class:"agent-check"},Ve=["onKeydown"],Pe=["disabled"],Ue=te({__name:"App",setup(Ge){const M=r(),E=r(),g=r(""),h=r(!1),d=r([]),v=r(1),m=r(!1),w=r([]),c=r(null),p=r(!1),k=r(""),b=r(!1),f=r(null),A=r(""),I=r(""),y=r("gpt-3.5-turbo"),T=r(""),C=r(!1),L=G(()=>window.self!==window.top),H=G(()=>{if(!k.value)return w.value;const s=k.value.toLowerCase();return w.value.filter(t=>{var o;return t.name.toLowerCase().includes(s)||t.description.toLowerCase().includes(s)||((o=t.tags)==null?void 0:o.some(i=>i.toLowerCase().includes(s)))})});se(async()=>{const s=new URLSearchParams(window.location.search),t=s.get("sessionId");t&&(v.value=parseInt(t));const o=s.get("pageUrl"),i=s.get("pageTitle");o&&(A.value=decodeURIComponent(o)),i&&(I.value=decodeURIComponent(i)),await K(),await N(),await R(),_(()=>{var n;(n=E.value)==null||n.focus()}),window.addEventListener("message",n=>{n.data.type==="PIN_STATUS_CHANGED"&&(m.value=n.data.isPinned),n.data.type==="PAGE_INFO"&&(A.value=n.data.url,I.value=n.data.title,N())}),document.addEventListener("click",n=>{n.target.closest(".agent-selector")||(p.value=!1)})});const N=async()=>{b.value=!0;try{const s=await chrome.runtime.sendMessage({type:"GET_AGENTS",payload:{url:A.value}});if(s.success&&s.data){if(w.value=s.data.agents||[],f.value=s.data.recommended||null,f.value&&!c.value){const t=w.value.find(o=>o.id===f.value);t&&(c.value=t)}!c.value&&w.value.length>0&&(c.value=w.value[0])}}catch(s){console.error("加载 Agent 列表失败:",s)}finally{b.value=!1}},R=async()=>{try{const s=await chrome.runtime.sendMessage({type:"GET_SETTING",payload:{key:"model"}});s!=null&&s.success&&s.data?y.value=s.data:y.value="gpt-3.5-turbo"}catch(s){console.error("加载模型设置失败:",s),y.value="gpt-3.5-turbo"}},F=()=>{p.value=!p.value,p.value&&(k.value="")},$=s=>{c.value=s,p.value=!1},K=async()=>{const s=await chrome.runtime.sendMessage({type:"GET_MESSAGES",payload:{sessionId:v.value}});s.success&&(d.value=s.data,_(S))},V=async()=>{if(!g.value.trim()||h.value||C.value)return;const s=g.value.trim();g.value="",d.value.push({sessionId:v.value,role:"user",content:s,createdAt:Date.now()}),_(S),c.value?await O(s):await q(s)},O=async s=>{C.value=!0,T.value="";const t={sessionId:v.value,role:"assistant",content:"",createdAt:Date.now()};d.value.push(t);const o=d.value.length-1;try{const i=chrome.runtime.connect({name:"chat-stream"});i.onMessage.addListener(n=>{n.type==="content"?(T.value+=n.content,d.value[o].content=T.value,_(S)):n.type==="done"?(C.value=!1,i.disconnect()):n.type==="error"&&(console.error("流式响应错误:",n.error),d.value[o].content=`错误: ${n.error}`,C.value=!1,i.disconnect())}),i.postMessage({agentId:c.value.id,sessionId:v.value,message:s,context:{url:A.value,title:I.value}})}catch(i){console.error("发送流式消息失败:",i),d.value[o].content=`发送失败: ${i}`,C.value=!1}},q=async s=>{h.value=!0;try{const t=await chrome.runtime.sendMessage({type:"SEND_MESSAGE",payload:{sessionId:v.value,content:s}});t.success&&(d.value.push({sessionId:v.value,role:"assistant",content:t.response,createdAt:Date.now()}),_(S))}catch(t){console.error("发送消息失败:",t)}finally{h.value=!1}},S=()=>{M.value&&(M.value.scrollTop=M.value.scrollHeight)},Q=s=>new Date(s).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),J=()=>{console.log("togglePin clicked, current isPinned:",m.value),window.parent&&window.parent!==window?(console.log("Sending PIN_CHAT message to parent"),window.parent.postMessage({type:"PIN_CHAT"},"*"),m.value=!m.value):console.log("Not in iframe, cannot pin")},W=()=>{window.parent&&window.parent!==window?window.parent.postMessage({type:"CLOSE_CHAT"},"*"):window.close()},X=()=>{const s=chrome.runtime.getURL(`chat.html?sessionId=${v.value}`);chrome.tabs.create({url:s}),window.parent&&window.parent.postMessage({type:"CLOSE_CHAT"},"*")},Y=()=>{chrome.tabs.create({url:"https://github.com/anthropics/claude-code/issues"})},Z=()=>{const s=chrome.runtime.getURL("options.html");chrome.tabs.create({url:s})};return(s,t)=>(a(),l("div",ie,[e("div",de,[e("div",ce,[e("div",ue,[t[4]||(t[4]=e("div",{class:"logo-icon"},[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[e("path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})])],-1)),e("div",ve,[t[3]||(t[3]=e("h3",null,"AI Chat Assistant",-1)),y.value?(a(),l("span",pe,x(y.value),1)):u("",!0)])]),e("div",ge,[e("button",{class:"icon-btn",onClick:Y,title:"帮助文档"},[...t[5]||(t[5]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[e("circle",{cx:"12",cy:"12",r:"10","stroke-width":"2"}),e("path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}),e("line",{x1:"12",y1:"17",x2:"12.01",y2:"17","stroke-width":"2","stroke-linecap":"round"})],-1)])]),e("button",{class:"icon-btn",onClick:Z,title:"设置"},[...t[6]||(t[6]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[e("circle",{cx:"12",cy:"12",r:"3","stroke-width":"2"}),e("path",{d:"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)])]),L.value?(a(),l("button",{key:0,class:z(["icon-btn",{active:m.value}]),onClick:J,title:"固定窗口"},[...t[7]||(t[7]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[e("path",{d:"M16 4v8l3 3-2 2-3-3-4 4-2-2 4-4-3-3 2-2 3 3V4h2z","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)])],2)):u("",!0),L.value?(a(),l("button",{key:1,class:"icon-btn",onClick:X,title:"全屏打开"},[...t[8]||(t[8]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[e("path",{d:"M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)])])):u("",!0),e("button",{class:"icon-btn",onClick:W,title:"关闭"},[...t[9]||(t[9]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[e("line",{x1:"18",y1:"6",x2:"6",y2:"18","stroke-width":"2","stroke-linecap":"round"}),e("line",{x1:"6",y1:"6",x2:"18",y2:"18","stroke-width":"2","stroke-linecap":"round"})],-1)])])])]),e("div",{class:"chat-messages",ref_key:"messagesContainer",ref:M},[d.value.length===0?(a(),l("div",we,[...t[10]||(t[10]=[e("svg",{class:"empty-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[e("path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1),e("p",null,"开始对话吧！",-1)])])):u("",!0),(a(!0),l(P,null,U(d.value,o=>(a(),l("div",{key:o.id,class:z(["message",o.role])},[e("div",he,[o.role==="user"?(a(),l("svg",me,[...t[11]||(t[11]=[e("path",{d:"M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"},null,-1)])])):(a(),l("svg",ke,[...t[12]||(t[12]=[e("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm-1-13h2v6h-2zm0 8h2v2h-2z"},null,-1)])]))]),e("div",fe,[e("div",ye,x(o.content),1),e("div",Ce,x(Q(o.createdAt)),1)])],2))),128)),h.value?(a(),l("div",_e,[...t[13]||(t[13]=[oe('<div class="message-avatar" data-v-3d7251a3><svg viewBox="0 0 24 24" fill="currentColor" data-v-3d7251a3><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm-1-13h2v6h-2zm0 8h2v2h-2z" data-v-3d7251a3></path></svg></div><div class="message-content-wrapper" data-v-3d7251a3><div class="typing-indicator" data-v-3d7251a3><span data-v-3d7251a3></span><span data-v-3d7251a3></span><span data-v-3d7251a3></span></div></div>',2)])])):u("",!0)],512),e("div",xe,[e("div",{class:"agent-selector",onClick:F},[e("div",{class:z(["agent-selector-btn",{active:p.value}])},[t[14]||(t[14]=e("svg",{viewBox:"0 0 24 24",fill:"currentColor"},[e("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 3c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm0 14.2c-2.5 0-4.71-1.28-6-3.22.03-1.99 4-3.08 6-3.08 1.99 0 5.97 1.09 6 3.08-1.29 1.94-3.5 3.22-6 3.22z"})],-1)),c.value?(a(),l("span",Me)):u("",!0)],2),p.value?(a(),l("div",Ae,[e("div",Se,[D(e("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=o=>k.value=o),placeholder:"搜索 Agent...",onClick:t[1]||(t[1]=B(()=>{},["stop"]))},null,512),[[j,k.value]])]),e("div",ze,[b.value?(a(),l("div",be,[...t[15]||(t[15]=[e("div",{class:"loading-spinner"},null,-1),e("span",null,"加载中...",-1)])])):H.value.length===0?(a(),l("div",Ie," 暂无可用 Agent ")):(a(!0),l(P,{key:2},U(H.value,o=>{var i,n;return a(),l("div",{key:o.id,class:z(["agent-dropdown-item",{selected:((i=c.value)==null?void 0:i.id)===o.id,recommended:o.id===f.value}]),onClick:B(ee=>$(o),["stop"])},[t[17]||(t[17]=e("div",{class:"agent-dropdown-avatar"},[e("svg",{viewBox:"0 0 24 24",fill:"currentColor"},[e("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 3c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm0 14.2c-2.5 0-4.71-1.28-6-3.22.03-1.99 4-3.08 6-3.08 1.99 0 5.97 1.09 6 3.08-1.29 1.94-3.5 3.22-6 3.22z"})])],-1)),e("div",Be,[e("div",Ee,[ae(x(o.name)+" ",1),o.id===f.value?(a(),l("span",Le,"推荐")):u("",!0)]),e("div",He,x(o.description),1)]),((n=c.value)==null?void 0:n.id)===o.id?(a(),l("div",Ne,[...t[16]||(t[16]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[e("polyline",{points:"20 6 9 17 4 12","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)])])):u("",!0)],10,Te)}),128))])])):u("",!0)]),D(e("textarea",{"onUpdate:modelValue":t[2]||(t[2]=o=>g.value=o),onKeydown:ne(B(V,["exact","prevent"]),["enter"]),placeholder:"输入消息... (Enter发送)",rows:"1",ref_key:"inputArea",ref:E},null,40,Ve),[[j,g.value]]),e("button",{class:"send-btn",onClick:V,disabled:!g.value.trim()||h.value},[...t[18]||(t[18]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[e("line",{x1:"22",y1:"2",x2:"11",y2:"13","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}),e("polygon",{points:"22 2 15 22 11 13 2 9 22 2","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)])],8,Pe)])])]))}}),De=le(Ue,[["__scopeId","data-v-3d7251a3"]]),je=re(De);je.mount("#app");

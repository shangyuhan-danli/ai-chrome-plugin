var Qe=Object.defineProperty;var Ye=($,a,v)=>a in $?Qe($,a,{enumerable:!0,configurable:!0,writable:!0,value:v}):$[a]=v;var ke=($,a,v)=>Ye($,typeof a!="symbol"?a+"":a,v);import{d as Ze,f as et,m as S,o as u,c as p,b as t,t as x,g as w,w as L,n as B,p as he,F as H,r as Y,h as re,v as ie,q as le,s as tt,l as m,u as Z,_ as st,e as ot}from"./chunks/_plugin-vue_export-helper-BVLuoGCU.js";class nt{constructor(){ke(this,"tools",new Map);this.registerBuiltinTools()}registerBuiltinTools(){this.register({name:"page_action",description:"åœ¨ç”¨æˆ·å½“å‰æµè§ˆçš„ç½‘é¡µä¸Šæ‰§è¡Œæ“ä½œï¼Œå¦‚å¡«å……è¾“å…¥æ¡†ã€ç‚¹å‡»æŒ‰é’®ã€é«˜äº®æ–‡å­—ç­‰ã€‚å¯ä»¥æ‰¹é‡æ‰§è¡Œå¤šä¸ªæ“ä½œã€‚",parameters:{type:"object",properties:{actions:{type:"array",description:"è¦æ‰§è¡Œçš„æ“ä½œåˆ—è¡¨",items:{type:"object",properties:{action:{type:"string",enum:["fill","click","doubleClick","rightClick","highlight","underline","select","selectText","check","scroll","read","hover","type","press","drag","wait","focus","blur","clear","getAttribute","getProperty","navigate","scrollIntoView","switchFrame","handleDialog","setLocalStorage","getLocalStorage","clearLocalStorage","setCookie","getCookie","clearCookies","copyToClipboard","pasteFromClipboard","upload","evaluate","addListItem","removeListItem","editListItem","setContent","appendContent","prependContent","insertHTML"],description:"æ“ä½œç±»å‹: fill(å¡«å……è¾“å…¥æ¡†), click(ç‚¹å‡»), doubleClick(åŒå‡»), rightClick(å³é”®), highlight(é«˜äº®), underline(ä¸‹åˆ’çº¿), select(é€‰æ‹©), selectText(é€‰ä¸­æ–‡æœ¬), check(å‹¾é€‰), scroll(æ»šåŠ¨), read(è¯»å–), hover(æ‚¬åœ), type(æ‰“å­—), press(æŒ‰é”®), drag(æ‹–æ‹½), wait(ç­‰å¾…), focus(èšç„¦), blur(å¤±ç„¦), clear(æ¸…ç©º), getAttribute(è·å–å±æ€§), getProperty(è·å–å±æ€§å€¼), navigate(å¯¼èˆª), scrollIntoView(æ»šåŠ¨åˆ°å…ƒç´ ), switchFrame(åˆ‡æ¢iframe), handleDialog(å¤„ç†å¼¹çª—), setLocalStorage(è®¾ç½®å­˜å‚¨), getLocalStorage(è·å–å­˜å‚¨), clearLocalStorage(æ¸…é™¤å­˜å‚¨), setCookie(è®¾ç½®Cookie), getCookie(è·å–Cookie), clearCookies(æ¸…é™¤Cookies), copyToClipboard(å¤åˆ¶), pasteFromClipboard(ç²˜è´´), upload(ä¸Šä¼ æ–‡ä»¶), evaluate(æ‰§è¡ŒJS), addListItem(æ·»åŠ åˆ—è¡¨é¡¹), removeListItem(åˆ é™¤åˆ—è¡¨é¡¹), editListItem(ç¼–è¾‘åˆ—è¡¨é¡¹), setContent(è®¾ç½®å†…å®¹), appendContent(è¿½åŠ å†…å®¹), prependContent(å‰ç½®å†…å®¹), insertHTML(æ’å…¥HTML)"},target:{type:"object",description:"ç›®æ ‡å…ƒç´ ",properties:{elementId:{type:"string",description:"å…ƒç´ ID (ä»é¡µé¢ä¸Šä¸‹æ–‡è·å–)"},selector:{type:"string",description:"CSSé€‰æ‹©å™¨ (å¤‡ç”¨)"},description:{type:"string",description:"å…ƒç´ æè¿° (ç”¨äºç¡®è®¤)"}}},params:{type:"object",description:"æ“ä½œå‚æ•°",properties:{value:{type:"string",description:"å¡«å……çš„å€¼ã€é€‰æ‹©çš„é€‰é¡¹ã€è¾“å…¥çš„æ–‡æœ¬æˆ–æŒ‰é”®å"},color:{type:"string",description:"é«˜äº®é¢œè‰² (å¦‚ #ffeb3b)"},direction:{type:"string",enum:["up","down","top","bottom"],description:"æ»šåŠ¨æ–¹å‘"},delay:{type:"number",description:"è¾“å…¥å»¶è¿Ÿï¼ˆæ¯«ç§’ï¼‰ï¼Œç”¨äºtypeæ“ä½œ"},key:{type:"string",description:"æŒ‰é”®åï¼ˆEnter, Tab, Escapeç­‰ï¼‰"},destination:{type:"object",description:"æ‹–æ‹½ç›®æ ‡ä½ç½®",properties:{selector:{type:"string",description:"ç›®æ ‡å…ƒç´ CSSé€‰æ‹©å™¨"},x:{type:"number",description:"ç›®æ ‡Xåæ ‡"},y:{type:"number",description:"ç›®æ ‡Yåæ ‡"}}},timeout:{type:"number",description:"ç­‰å¾…è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰"},condition:{type:"string",enum:["visible","hidden","exists"],description:"ç­‰å¾…æ¡ä»¶"},behavior:{type:"string",enum:["auto","smooth"],description:"æ»šåŠ¨è¡Œä¸º"},block:{type:"string",enum:["start","center","end","nearest"],description:"æ»šåŠ¨å¯¹é½æ–¹å¼"},attribute:{type:"string",description:"è¦è·å–çš„å±æ€§å"},property:{type:"string",description:"è¦è·å–çš„å±æ€§å€¼å"},navigateAction:{type:"string",enum:["goto","back","forward","reload"],description:"å¯¼èˆªæ“ä½œç±»å‹"},url:{type:"string",description:"å¯¼èˆªURLï¼ˆnavigateAction=gotoæ—¶ä½¿ç”¨ï¼‰"},frameSelector:{type:"string",description:"iframeé€‰æ‹©å™¨"},dialogAction:{type:"string",enum:["accept","dismiss"],description:"å¼¹çª—å¤„ç†æ–¹å¼"},promptText:{type:"string",description:"promptå¼¹çª—çš„è¾“å…¥å€¼"},prefix:{type:"string",description:"localStorageé”®åå‰ç¼€ï¼ˆç”¨äºæ‰¹é‡æ¸…é™¤ï¼‰"},name:{type:"string",description:"Cookieåç§°"},cookieOptions:{type:"object",description:"Cookieé€‰é¡¹",properties:{expires:{type:"number",description:"è¿‡æœŸæ—¶é—´ï¼ˆç§’ï¼‰"},path:{type:"string",description:"è·¯å¾„"},domain:{type:"string",description:"åŸŸå"},secure:{type:"boolean",description:"æ˜¯å¦ä»…HTTPS"}}},text:{type:"string",description:"è¦å¤åˆ¶çš„æ–‡æœ¬ï¼ˆcopyToClipboardä½¿ç”¨ï¼‰"},searchText:{type:"string",description:"è¦é€‰ä¸­çš„æ–‡æœ¬å†…å®¹ï¼ˆselectTextä½¿ç”¨ï¼‰"},startOffset:{type:"number",description:"é€‰æ‹©èµ·å§‹åç§»ï¼ˆselectTextä½¿ç”¨ï¼‰"},endOffset:{type:"number",description:"é€‰æ‹©ç»“æŸåç§»ï¼ˆselectTextä½¿ç”¨ï¼‰"},script:{type:"string",description:"è¦æ‰§è¡Œçš„JavaScriptä»£ç ï¼ˆevaluateä½¿ç”¨ï¼‰"},files:{type:"array",description:"è¦ä¸Šä¼ çš„æ–‡ä»¶åˆ—è¡¨ï¼ˆuploadä½¿ç”¨ï¼‰",items:{type:"object",properties:{name:{type:"string",description:"æ–‡ä»¶å"},type:{type:"string",description:"MIMEç±»å‹"},content:{type:"string",description:"base64ç¼–ç çš„æ–‡ä»¶å†…å®¹"}}}},listSelector:{type:"string",description:"åˆ—è¡¨å®¹å™¨é€‰æ‹©å™¨ï¼ˆaddListItemä½¿ç”¨ï¼‰"},itemContent:{type:"string",description:"åˆ—è¡¨é¡¹å†…å®¹ï¼ˆaddListItem/editListItemä½¿ç”¨ï¼‰"},position:{type:"string",enum:["before","after","first","last"],description:"æ’å…¥ä½ç½®ï¼ˆaddListItemä½¿ç”¨ï¼‰"},itemIndex:{type:"number",description:"åˆ—è¡¨é¡¹ç´¢å¼•ï¼ˆremoveListItemä½¿ç”¨ï¼‰"},content:{type:"string",description:"æ–‡æœ¬å†…å®¹ï¼ˆsetContent/appendContent/prependContentä½¿ç”¨ï¼‰"},html:{type:"string",description:"HTMLå†…å®¹ï¼ˆinsertHTMLä½¿ç”¨ï¼‰"},insertPosition:{type:"string",enum:["beforebegin","afterbegin","beforeend","afterend"],description:"HTMLæ’å…¥ä½ç½®: beforebegin(å…ƒç´ å‰), afterbegin(å†…éƒ¨å¼€å¤´), beforeend(å†…éƒ¨æœ«å°¾), afterend(å…ƒç´ å)"}}}},required:["action","target"]}}},required:["actions"]},execute:async(a,v)=>{const g=a.actions||[a],b=await chrome.tabs.sendMessage(v,{type:"EXECUTE_BATCH_ACTIONS",payload:g});return(b==null?void 0:b.data)||{success:!1,error:"æ‰§è¡Œå¤±è´¥"}}}),this.register({name:"screenshot",description:"æˆªå–å½“å‰é¡µé¢çš„å¯è§åŒºåŸŸæˆªå›¾ï¼Œè¿”å›base64ç¼–ç çš„PNGå›¾ç‰‡ã€‚",parameters:{type:"object",properties:{format:{type:"string",enum:["png","jpeg"],description:"å›¾ç‰‡æ ¼å¼ï¼Œé»˜è®¤png"},quality:{type:"number",description:"JPEGè´¨é‡(0-100)ï¼Œä»…format=jpegæ—¶æœ‰æ•ˆ"}}},execute:async(a,v)=>{try{const g={format:a.format||"png"};return a.format==="jpeg"&&a.quality&&(g.quality=a.quality),{success:!0,data:await chrome.tabs.captureVisibleTab(void 0,g)}}catch(g){return{success:!1,error:String(g)}}}}),this.register({name:"download",description:"ä¸‹è½½æŒ‡å®šURLçš„æ–‡ä»¶åˆ°æœ¬åœ°ã€‚",parameters:{type:"object",properties:{url:{type:"string",description:"è¦ä¸‹è½½çš„æ–‡ä»¶URL"},filename:{type:"string",description:"ä¿å­˜çš„æ–‡ä»¶åï¼ˆå¯é€‰ï¼‰"},saveAs:{type:"boolean",description:"æ˜¯å¦æ˜¾ç¤ºå¦å­˜ä¸ºå¯¹è¯æ¡†"}},required:["url"]},execute:async a=>{try{const v={url:a.url};return a.filename&&(v.filename=a.filename),a.saveAs!==void 0&&(v.saveAs=a.saveAs),{success:!0,downloadId:await chrome.downloads.download(v)}}catch(v){return{success:!1,error:String(v)}}}}),this.register({name:"setViewport",description:"è°ƒæ•´æµè§ˆå™¨çª—å£å¤§å°ä»¥æ¨¡æ‹Ÿä¸åŒè®¾å¤‡çš„è§†å£ã€‚",parameters:{type:"object",properties:{width:{type:"number",description:"è§†å£å®½åº¦ï¼ˆåƒç´ ï¼‰"},height:{type:"number",description:"è§†å£é«˜åº¦ï¼ˆåƒç´ ï¼‰"}},required:["width","height"]},execute:async a=>{try{const[v]=await chrome.tabs.query({active:!0,currentWindow:!0});return v!=null&&v.windowId?(await chrome.windows.update(v.windowId,{width:a.width,height:a.height}),{success:!0,message:`è§†å£å·²è®¾ç½®ä¸º ${a.width}x${a.height}`}):{success:!1,error:"æ— æ³•è·å–å½“å‰çª—å£"}}catch(v){return{success:!1,error:String(v)}}}}),this.register({name:"interceptRequest",description:"æ‹¦æˆªåŒ¹é…æŒ‡å®šæ¨¡å¼çš„ç½‘ç»œè¯·æ±‚ï¼Œå¯ä»¥é˜»æ­¢æˆ–é‡å®šå‘è¯·æ±‚ã€‚",parameters:{type:"object",properties:{action:{type:"string",enum:["add","remove","list"],description:"æ“ä½œç±»å‹: add(æ·»åŠ è§„åˆ™), remove(ç§»é™¤è§„åˆ™), list(åˆ—å‡ºè§„åˆ™)"},ruleId:{type:"number",description:"è§„åˆ™IDï¼ˆremoveæ—¶å¿…éœ€ï¼‰"},urlPattern:{type:"string",description:"URLåŒ¹é…æ¨¡å¼ï¼ˆaddæ—¶å¿…éœ€ï¼‰"},interceptAction:{type:"string",enum:["block","redirect"],description:"æ‹¦æˆªæ“ä½œ: block(é˜»æ­¢), redirect(é‡å®šå‘)"},redirectUrl:{type:"string",description:"é‡å®šå‘URLï¼ˆinterceptAction=redirectæ—¶å¿…éœ€ï¼‰"},resourceTypes:{type:"array",description:"è¦æ‹¦æˆªçš„èµ„æºç±»å‹",items:{type:"string",enum:["main_frame","sub_frame","stylesheet","script","image","font","object","xmlhttprequest","ping","media","websocket","other"]}}},required:["action"]},execute:async a=>{try{if(a.action==="list")return{success:!0,rules:await chrome.declarativeNetRequest.getDynamicRules()};if(a.action==="remove")return a.ruleId?(await chrome.declarativeNetRequest.updateDynamicRules({removeRuleIds:[a.ruleId]}),{success:!0,message:`å·²ç§»é™¤è§„åˆ™ ${a.ruleId}`}):{success:!1,error:"ç§»é™¤è§„åˆ™éœ€è¦æä¾›ruleId"};if(a.action==="add"){if(!a.urlPattern)return{success:!1,error:"æ·»åŠ è§„åˆ™éœ€è¦æä¾›urlPattern"};const v=Date.now()%1e6,g={id:v,priority:1,condition:{urlFilter:a.urlPattern,resourceTypes:a.resourceTypes||["main_frame","sub_frame","script","xmlhttprequest"]},action:a.interceptAction==="redirect"&&a.redirectUrl?{type:"redirect",redirect:{url:a.redirectUrl}}:{type:"block"}};return await chrome.declarativeNetRequest.updateDynamicRules({addRules:[g]}),{success:!0,ruleId:v,message:"å·²æ·»åŠ æ‹¦æˆªè§„åˆ™"}}return{success:!1,error:"æœªçŸ¥æ“ä½œ"}}catch(v){return{success:!1,error:String(v)}}}}),this.register({name:"request_more_elements",description:"å½“å‰é¡µé¢å…ƒç´ ä¿¡æ¯ä¸è¶³ä»¥å®Œæˆç”¨æˆ·è¯·æ±‚æ—¶ï¼Œè¯·æ±‚ç‰¹å®šåŒºåŸŸæˆ–ç±»å‹çš„æ›´å¤šå…ƒç´ ã€‚",parameters:{type:"object",properties:{region:{type:"string",enum:["form","header","sidebar","footer","below_viewport"],description:"é¡µé¢åŒºåŸŸ: form(è¡¨å•åŒºåŸŸ), header(é¡µå¤´), sidebar(ä¾§è¾¹æ ), footer(é¡µè„š), below_viewport(è§†å£ä¸‹æ–¹)"},elementType:{type:"string",enum:["input","button","link","select","all"],description:"å…ƒç´ ç±»å‹: input(è¾“å…¥æ¡†), button(æŒ‰é’®), link(é“¾æ¥), select(ä¸‹æ‹‰æ¡†), all(æ‰€æœ‰)"},keyword:{type:"string",description:"å…³é”®è¯ç­›é€‰ï¼ŒåŒ¹é…å…ƒç´ çš„æ–‡æœ¬ã€placeholderã€labelç­‰"}}},execute:async(a,v)=>{const g=await chrome.tabs.sendMessage(v,{type:"REQUEST_MORE_ELEMENTS",payload:a});return{success:!0,elements:(g==null?void 0:g.data)||[]}}}),this.register({name:"get_selected_text",description:"è·å–ç”¨æˆ·åœ¨é¡µé¢ä¸Šé€‰ä¸­çš„æ–‡å­—ï¼Œç”¨äºå¯¹é€‰ä¸­å†…å®¹è¿›è¡Œæ“ä½œã€‚",parameters:{type:"object",properties:{}},execute:async(a,v)=>{const g=await chrome.tabs.sendMessage(v,{type:"GET_SELECTED_TEXT"});return{success:!0,text:(g==null?void 0:g.data)||""}}}),this.register({name:"clear_ai_styles",description:"æ¸…é™¤ AI åœ¨é¡µé¢ä¸Šæ·»åŠ çš„æ‰€æœ‰é«˜äº®å’Œä¸‹åˆ’çº¿æ ·å¼ï¼Œæ¢å¤é¡µé¢åŸå§‹çŠ¶æ€ã€‚",parameters:{type:"object",properties:{}},execute:async(a,v)=>{const g=await chrome.tabs.sendMessage(v,{type:"CLEAR_AI_STYLES"});return{success:(g==null?void 0:g.success)||!1}}})}register(a){this.tools.set(a.name,a)}unregister(a){this.tools.delete(a)}isBrowserTool(a){return this.tools.has(a)}getToolNames(){return Array.from(this.tools.keys())}getToolDefinitions(){return Array.from(this.tools.values()).map(a=>({name:a.name,description:a.description,parameters:a.parameters}))}async execute(a,v){const g=this.tools.get(a);if(!g)return JSON.stringify({success:!1,error:`æœªçŸ¥çš„æµè§ˆå™¨å·¥å…·: ${a}`});try{const[b]=await chrome.tabs.query({active:!0,currentWindow:!0});if(!(b!=null&&b.id))return JSON.stringify({success:!1,error:"æ— æ³•è·å–å½“å‰æ ‡ç­¾é¡µ"});let r;try{r=JSON.parse(v)}catch{return JSON.stringify({success:!1,error:"æ— æ•ˆçš„å‚æ•°æ ¼å¼"})}const k=await g.execute(r,b.id);return JSON.stringify(k)}catch(b){return console.error(`æ‰§è¡Œå·¥å…· ${a} å¤±è´¥:`,b),JSON.stringify({success:!1,error:String(b)})}}}const z=new nt,at={class:"chat-wrapper"},rt={class:"chat-container"},it={class:"chat-header"},lt={class:"header-left"},ct={class:"header-title"},dt={class:"header-badges"},ut=["title"],pt={key:1,class:"model-badge"},vt={class:"header-right"},yt={key:0,class:"session-dropdown-menu"},gt={class:"session-dropdown-header"},mt={class:"session-dropdown-list"},ft={key:0,class:"session-dropdown-loading"},kt={key:1,class:"session-dropdown-empty"},ht=["onClick"],wt={class:"session-dropdown-info"},bt={class:"session-dropdown-title"},_t={class:"session-dropdown-meta"},xt={key:0,class:"session-url"},Ct={class:"session-time"},Tt={class:"session-dropdown-actions"},St=["onClick"],It=["onClick"],Mt=["onClick"],At={key:0,class:"session-check"},Lt={class:"modal-body"},Et={class:"modal-body"},jt={key:0,class:"empty-state"},Nt={class:"message-box user-box"},Bt={class:"message-time"},Rt={class:"assistant-content"},Dt={key:0,class:"think-block"},$t={class:"think-content"},Ot={key:0,class:"message-box assistant-box"},Ut={class:"block-content"},Pt={key:1,class:"tool-block"},Ht={class:"tool-header"},qt={class:"tool-name"},Jt={key:0,class:"tool-badge approved"},Vt={key:1,class:"tool-badge rejected"},zt={class:"tool-params-container"},Gt=["innerHTML"],Ft={key:0,class:"tool-actions"},Kt=["onClick"],Xt=["onClick"],Wt={key:2,class:"summary-block"},Qt={class:"summary-content"},Yt={class:"message-time"},Zt={key:1,class:"message assistant"},es={key:2,class:"token-stats-bar"},ts={class:"token-stats-content"},ss={class:"token-stats-info"},os={class:"token-used"},ns={class:"token-limit"},as={key:0,class:"token-warning-text"},rs={class:"token-progress-bar"},is={class:"chat-input-area"},ls={key:0,class:"agent-selected-indicator"},cs={key:0,class:"agent-dropdown-menu"},ds={class:"agent-dropdown-header"},us={class:"agent-dropdown-list"},ps={key:0,class:"agent-dropdown-loading"},vs={key:1,class:"agent-dropdown-empty"},ys=["onClick"],gs={class:"agent-dropdown-info"},ms={class:"agent-dropdown-name"},fs={key:0,class:"recommended-tag"},ks={class:"agent-dropdown-desc"},hs={key:0,class:"agent-check"},ws=["onKeydown"],bs=["disabled"],ce=2e5,_s=Ze({__name:"App",setup($){const a=m(),v=m(),g=m(""),b=m(!1),r=m([]),k=m(1),q=m(!1),we=Z(()=>{if(r.value.length===0)return!1;const o=r.value[r.value.length-1];return o.role!=="assistant"?!1:o.blocks.some(e=>e.type==="tool_use"&&e.status==="pending")}),J=m([]),C=m(null),O=m(!1),G=m(""),ee=m(!1),F=m(null),X=m(""),W=m(""),V=m([]),U=m(!1),te=m(!1),R=m({total:0,prompt:0,completion:0}),K=Z(()=>R.value.total/ce*100),se=o=>o>=1e6?(o/1e6).toFixed(1)+"M":o>=1e3?(o/1e3).toFixed(1)+"K":o.toString(),N=m("gpt-3.5-turbo"),h=m(""),_=m(!1),be=m(null),oe=Z(()=>window.self!==window.top),de=Z(()=>{if(!G.value)return J.value;const o=G.value.toLowerCase();return J.value.filter(e=>{var s;return e.name.toLowerCase().includes(o)||e.description.toLowerCase().includes(o)||((s=e.tags)==null?void 0:s.some(n=>n.toLowerCase().includes(o)))})});et(async()=>{const o=new URLSearchParams(window.location.search),e=o.get("sessionId");e&&(k.value=parseInt(e));const s=o.get("pageUrl"),n=o.get("pageTitle");s&&(X.value=decodeURIComponent(s)),n&&(W.value=decodeURIComponent(n)),await pe(),await ue(),await _e(),S(()=>{var l;(l=v.value)==null||l.focus()}),window.addEventListener("message",l=>{l.data.type==="PIN_STATUS_CHANGED"&&(q.value=l.data.isPinned),l.data.type==="PAGE_INFO"&&(X.value=l.data.url,W.value=l.data.title,ue())}),document.addEventListener("click",l=>{const y=l.target;y.closest(".agent-selector")||(O.value=!1),y.closest(".session-selector")||(U.value=!1)})});const ue=async()=>{ee.value=!0;try{const o=await chrome.runtime.sendMessage({type:"GET_AGENTS",payload:{userId:"default_user"}});if(o.success&&o.data){if(J.value=o.data.agents||[],F.value=o.data.recommended||null,F.value&&!C.value){const e=J.value.find(s=>s.id===F.value);e&&(C.value=e)}!C.value&&J.value.length>0&&(C.value=J.value[0])}}catch(o){console.error("åŠ è½½ Agent åˆ—è¡¨å¤±è´¥:",o)}finally{ee.value=!1}},_e=async()=>{try{const o=await chrome.runtime.sendMessage({type:"GET_SETTING",payload:{key:"model"}});o!=null&&o.success&&o.data?N.value=o.data:N.value="gpt-3.5-turbo"}catch(o){console.error("åŠ è½½æ¨¡å‹è®¾ç½®å¤±è´¥:",o),N.value="gpt-3.5-turbo"}},xe=()=>{O.value=!O.value,O.value&&(G.value="")},Ce=o=>{C.value=o,O.value=!1},Te=async()=>{U.value=!U.value,U.value&&await Se()},Se=async()=>{te.value=!0;try{const o=await chrome.runtime.sendMessage({type:"GET_SESSIONS"});o.success&&(V.value=(o.data||[]).sort((e,s)=>s.updatedAt-e.updatedAt))}catch(o){console.error("åŠ è½½ä¼šè¯åˆ—è¡¨å¤±è´¥:",o)}finally{te.value=!1}},Ie=async o=>{k.value=o.id,U.value=!1,o.pageUrl&&(X.value=o.pageUrl),o.pageTitle&&(W.value=o.pageTitle),await pe()},Me=o=>{try{return new URL(o).hostname}catch{return o}},Ae=o=>{const s=Date.now()-o,n=Math.floor(s/6e4),l=Math.floor(s/36e5),y=Math.floor(s/864e5);return n<1?"åˆšåˆš":n<60?`${n}åˆ†é’Ÿå‰`:l<24?`${l}å°æ—¶å‰`:y<7?`${y}å¤©å‰`:new Date(o).toLocaleDateString("zh-CN")},pe=async()=>{const o=await chrome.runtime.sendMessage({type:"GET_MESSAGES",payload:{sessionId:k.value}});o.success&&(r.value=o.data.map(e=>({...e,blocks:e.blocks||[{type:"text",text:e.content}]})),S(M))},Le=o=>o.blocks.filter(s=>s.type==="text").map(s=>s.text).join(""),Ee=o=>JSON.stringify(o,null,2).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?)/g,s=>{let n="json-string";return/:$/.test(s)?(n="json-key",s=s.replace(/:$/,""),`<span class="${n}">${s}</span>:`):`<span class="${n}">${s}</span>`}).replace(/\b(true|false)\b/g,'<span class="json-boolean">$1</span>').replace(/\b(null)\b/g,'<span class="json-null">$1</span>').replace(/\b(-?\d+\.?\d*)\b/g,'<span class="json-number">$1</span>'),je=o=>{const e=o.currentTarget,s=e.parentElement,n=s==null?void 0:s.querySelector(".tool-params"),l=e.querySelector(".collapse-icon");n&&l&&(n.classList.toggle("collapsed"),l.classList.toggle("rotated"))},Q=async(o="")=>{if(!oe.value)return null;try{const[e]=await chrome.tabs.query({active:!0,currentWindow:!0});if(!(e!=null&&e.id))return null;const s=await chrome.tabs.sendMessage(e.id,{type:"GET_PAGE_CONTEXT",payload:{userMessage:o}});if(s!=null&&s.success)return be.value=s.data,s.data}catch(e){console.error("è·å–é¡µé¢ä¸Šä¸‹æ–‡å¤±è´¥:",e)}return null},Ne=async(o,e)=>await z.execute(o,e),Be=async(o,e,s)=>{var j;const n={sessionId:k.value,role:"user",blocks:[{type:"text",text:`[å·¥å…· ${o} æ‰§è¡Œç»“æœ]: ${s}`}],createdAt:Date.now()};r.value.push(n),S(M),_.value=!0,h.value="";const l={sessionId:k.value,role:"assistant",blocks:[{type:"text",text:""}],createdAt:Date.now()};r.value.push(l);const y=r.value.length-1;let T="",f=null;try{const I=await Q(),c=chrome.runtime.connect({name:"chat-stream"});c.onMessage.addListener(async i=>{if(i.type==="data"){const d=i.data;if(d.content){h.value+=d.content;const A=r.value[y].blocks.find(We=>We.type==="text");A&&A.type==="text"&&(A.text=h.value),S(M)}if(d.think&&d.think.reasoning_content&&(T=d.think.reasoning_content),d.toolCall&&d.toolCall.tool_name)try{f={type:"tool_use",id:`tool_${Date.now()}`,name:d.toolCall.tool_name,input:JSON.parse(d.toolCall.arguments||"{}"),status:"pending"}}catch(A){console.error("è§£æå·¥å…·å‚æ•°å¤±è´¥:",A)}d.statistic&&d.statistic.token_usage&&(R.value={total:d.statistic.token_usage.total_tokens||0,prompt:d.statistic.token_usage.prompt_tokens||0,completion:d.statistic.token_usage.completion_tokens||0})}else if(i.type==="done")_.value=!1,r.value[y].blocks=[],T&&(r.value[y].think=T),f?(r.value[y].blocks.push(f),r.value[y].isComplete=!1):(h.value&&r.value[y].blocks.push({type:"text",text:h.value}),r.value[y].isComplete=!0),c.disconnect(),S(M);else if(i.type==="error"){console.error("æµå¼å“åº”é”™è¯¯:",i.error);const d=r.value[y].blocks.find(A=>A.type==="text");d&&d.type==="text"&&(d.text=`é”™è¯¯: ${i.error}`),_.value=!1,c.disconnect()}}),c.postMessage({agentId:((j=C.value)==null?void 0:j.id)||"",sessionId:k.value,message:`æµè§ˆå™¨å·¥å…· ${o} æ‰§è¡Œç»“æœ: ${e}`,model:N.value,userId:"default_user",role:"user",currentPageInfo:I,browserTools:z.getToolDefinitions()})}catch(I){console.error("å‘é€å·¥å…·ç»“æœå¤±è´¥:",I),_.value=!1}},ve=async()=>{if(!g.value.trim()||b.value||_.value||we.value)return;const o=g.value.trim();g.value="";const e={sessionId:k.value,role:"user",blocks:[{type:"text",text:o}],createdAt:Date.now()};r.value.push(e),S(M),C.value&&C.value.id?await Re(o):await De(o)},Re=async o=>{_.value=!0,h.value="";const e={sessionId:k.value,role:"assistant",blocks:[{type:"text",text:""}],createdAt:Date.now()};r.value.push(e);const s=r.value.length-1;let n="",l=null,y="";try{const T=chrome.runtime.connect({name:"chat-stream"});T.onMessage.addListener(I=>{if(console.log("[Chat Stream] æ”¶åˆ°æ¶ˆæ¯:",I),I.type==="data"){const c=I.data;if(console.log("[Chat Stream] data å†…å®¹:",c),c.content){h.value+=c.content;const i=r.value[s].blocks.find(d=>d.type==="text");i&&i.type==="text"&&(i.text=h.value),S(M)}if(c.think&&c.think.reasoning_content&&(n=c.think.reasoning_content),c.toolCall&&c.toolCall.tool_name)try{l={type:"tool_use",id:`tool_${Date.now()}`,name:c.toolCall.tool_name,input:JSON.parse(c.toolCall.arguments||"{}"),status:"pending"}}catch(i){console.error("è§£æå·¥å…·å‚æ•°å¤±è´¥:",i)}c.statistic&&c.statistic.token_usage&&(R.value={total:c.statistic.token_usage.total_tokens||0,prompt:c.statistic.token_usage.prompt_tokens||0,completion:c.statistic.token_usage.completion_tokens||0}),c.answer&&c.answer.result&&(y=c.answer.result)}else if(I.type==="done")console.log("[Chat Stream] æµå¼ä¼ è¾“å®Œæˆ"),_.value=!1,r.value[s].blocks=[],n&&(r.value[s].think=n),l?(r.value[s].blocks.push(l),r.value[s].isComplete=!1):(!n&&h.value&&r.value[s].blocks.push({type:"text",text:h.value}),r.value[s].isComplete=!0),y&&(r.value[s].blocks.push({type:"summary",text:y}),r.value[s].isComplete=!0),T.disconnect(),S(M);else if(I.type==="error"){console.error("æµå¼å“åº”é”™è¯¯:",I.error);const c=r.value[s].blocks.find(i=>i.type==="text");c&&c.type==="text"&&(c.text=`é”™è¯¯: ${I.error}`),_.value=!1,T.disconnect()}});const f=await Q(o),j=z.getToolDefinitions();T.postMessage({agentId:C.value.id,sessionId:k.value,message:o,model:N.value,userId:"default_user",role:"user",currentPageInfo:f,browserTools:j})}catch(T){console.error("å‘é€æµå¼æ¶ˆæ¯å¤±è´¥:",T);const f=r.value[s].blocks.find(j=>j.type==="text");f&&f.type==="text"&&(f.text=`å‘é€å¤±è´¥: ${T}`),_.value=!1}},De=async o=>{b.value=!0;try{const e=await chrome.runtime.sendMessage({type:"SEND_MESSAGE",payload:{sessionId:k.value,content:o}});if(e.success){const s={sessionId:k.value,role:"assistant",blocks:e.blocks||[{type:"text",text:e.response}],createdAt:Date.now(),isComplete:e.isComplete!==!1};r.value.push(s),S(M)}}catch(e){console.error("å‘é€æ¶ˆæ¯å¤±è´¥:",e)}finally{b.value=!1}},ye=async(o,e)=>{const s=r.value[r.value.length-1];let n;s&&s.role==="assistant"&&(n=s.blocks.find(l=>l.type==="tool_use"&&l.id===o),n&&(n.status=e?"approved":"rejected")),e&&(n&&z.isBrowserTool(n.name)?await $e(n):await Oe(o))},$e=async o=>{const e=await Ne(o.name,JSON.stringify(o.input));let s="";try{const n=JSON.parse(e);s=n.summary||n.message||(n.success?"æ‰§è¡ŒæˆåŠŸ":"æ‰§è¡Œå¤±è´¥")}catch{s=e}await Be(o.name,e,s)},Oe=async o=>{var T;_.value=!0,h.value="";const e={sessionId:k.value,role:"assistant",blocks:[{type:"text",text:""}],createdAt:Date.now()};r.value.push(e);const s=r.value.length-1;let n="",l=null,y="";try{const f=chrome.runtime.connect({name:"chat-stream"});f.onMessage.addListener(async c=>{if(console.log("[NonBrowserTool] æ”¶åˆ°æ¶ˆæ¯:",c),c.type==="data"){const i=c.data;if(console.log("[NonBrowserTool] data å†…å®¹:",JSON.stringify(i)),i.role==="tool"){y+=i.content||"",console.log("[NonBrowserTool] æ”¶é›†å·¥å…·æ‰§è¡Œç»“æœ:",y);const d=r.value[s].blocks.find(A=>A.type==="text");d&&d.type==="text"&&(d.text=`[å·¥å…·æ‰§è¡Œä¸­...] ${y.substring(0,100)}...`),S(M);return}if(i.content){h.value+=i.content;const d=r.value[s].blocks.find(A=>A.type==="text");d&&d.type==="text"&&(d.text=h.value),S(M)}if(i.think&&i.think.reasoning_content&&(n+=i.think.reasoning_content),i.toolCall&&i.toolCall.tool_name)try{l={type:"tool_use",id:`tool_${Date.now()}`,name:i.toolCall.tool_name,input:JSON.parse(i.toolCall.arguments||"{}"),status:"pending"}}catch(d){console.error("è§£æå·¥å…·å‚æ•°å¤±è´¥:",d)}i.statistic&&i.statistic.token_usage&&(R.value={total:i.statistic.token_usage.total_tokens||0,prompt:i.statistic.token_usage.prompt_tokens||0,completion:i.statistic.token_usage.completion_tokens||0})}else if(c.type==="done"){if(console.log("[NonBrowserTool] æµå¼ä¼ è¾“å®Œæˆ"),console.log("[NonBrowserTool] toolResultContent:",y),f.disconnect(),y){console.log("[NonBrowserTool] æ£€æµ‹åˆ°å·¥å…·ç»“æœï¼Œç»§ç»­å‘é€è¯·æ±‚..."),r.value[s].blocks=[{type:"text",text:`[å·¥å…·æ‰§è¡Œç»“æœ]: ${y.substring(0,200)}${y.length>200?"...":""}`}],r.value[s].isComplete=!0,S(M),await Ue(o,y);return}_.value=!1,r.value[s].blocks=[],n&&(r.value[s].think=n),l?(r.value[s].blocks.push(l),r.value[s].isComplete=!1):(!n&&h.value&&r.value[s].blocks.push({type:"text",text:h.value}),r.value[s].isComplete=!0),S(M)}else if(c.type==="error"){console.error("æµå¼å“åº”é”™è¯¯:",c.error);const i=r.value[s].blocks.find(d=>d.type==="text");i&&i.type==="text"&&(i.text=`é”™è¯¯: ${c.error}`),_.value=!1,f.disconnect()}});const j=await Q(),I=z.getToolDefinitions();f.postMessage({agentId:((T=C.value)==null?void 0:T.id)||"",sessionId:k.value,message:JSON.stringify({toolId:o,approved:!0}),model:N.value,userId:"default_user",role:"function",currentPageInfo:j,browserTools:I})}catch(f){console.error("å¤„ç†å·¥å…·å“åº”å¤±è´¥:",f),_.value=!1}},Ue=async(o,e)=>{var T;h.value="";const s={sessionId:k.value,role:"assistant",blocks:[{type:"text",text:""}],createdAt:Date.now()};r.value.push(s);const n=r.value.length-1;let l="",y=null;try{const f=chrome.runtime.connect({name:"chat-stream"});f.onMessage.addListener(c=>{if(console.log("[SendToolResult] æ”¶åˆ°æ¶ˆæ¯:",c),c.type==="data"){const i=c.data;if(console.log("[SendToolResult] data å†…å®¹:",i),i.content){h.value+=i.content;const d=r.value[n].blocks.find(A=>A.type==="text");d&&d.type==="text"&&(d.text=h.value),S(M)}if(i.think&&i.think.reasoning_content&&(l+=i.think.reasoning_content),i.toolCall&&i.toolCall.tool_name)try{y={type:"tool_use",id:`tool_${Date.now()}`,name:i.toolCall.tool_name,input:JSON.parse(i.toolCall.arguments||"{}"),status:"pending"}}catch(d){console.error("è§£æå·¥å…·å‚æ•°å¤±è´¥:",d)}i.statistic&&i.statistic.token_usage&&(R.value={total:i.statistic.token_usage.total_tokens||0,prompt:i.statistic.token_usage.prompt_tokens||0,completion:i.statistic.token_usage.completion_tokens||0})}else if(c.type==="done")console.log("[SendToolResult] æµå¼ä¼ è¾“å®Œæˆ"),_.value=!1,r.value[n].blocks=[],l&&(r.value[n].think=l),y?(r.value[n].blocks.push(y),r.value[n].isComplete=!1):(!l&&h.value&&r.value[n].blocks.push({type:"text",text:h.value}),r.value[n].isComplete=!0),f.disconnect(),S(M);else if(c.type==="error"){console.error("æµå¼å“åº”é”™è¯¯:",c.error);const i=r.value[n].blocks.find(d=>d.type==="text");i&&i.type==="text"&&(i.text=`é”™è¯¯: ${c.error}`),_.value=!1,f.disconnect()}});const j=await Q(),I=z.getToolDefinitions();f.postMessage({agentId:((T=C.value)==null?void 0:T.id)||"",sessionId:k.value,message:"",model:N.value,userId:"default_user",role:"user",currentPageInfo:j,browserTools:I})}catch(f){console.error("å‘é€å·¥å…·ç»“æœå¤±è´¥:",f),_.value=!1}},M=()=>{a.value&&(a.value.scrollTop=a.value.scrollHeight)},ge=o=>new Date(o).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),Pe=()=>{console.log("togglePin clicked, current isPinned:",q.value),window.parent&&window.parent!==window?(console.log("Sending PIN_CHAT message to parent"),window.parent.postMessage({type:"PIN_CHAT"},"*"),q.value=!q.value):console.log("Not in iframe, cannot pin")},He=()=>{window.parent&&window.parent!==window?window.parent.postMessage({type:"CLOSE_CHAT"},"*"):window.close()},qe=()=>{const o=chrome.runtime.getURL(`chat.html?sessionId=${k.value}`);chrome.tabs.create({url:o}),window.parent&&window.parent.postMessage({type:"CLOSE_CHAT"},"*")},Je=()=>{chrome.tabs.create({url:"https://github.com/anthropics/claude-code/issues"})},Ve=()=>{const o=chrome.runtime.getURL("options.html");chrome.tabs.create({url:o})},ne=async()=>{try{const o=X.value,e=W.value||"æ–°å¯¹è¯",s=await chrome.runtime.sendMessage({type:"CREATE_SESSION",payload:{title:e,pageUrl:o,pageTitle:e}});s.success&&(k.value=s.data.id,r.value=[],h.value="",_.value=!1,b.value=!1,S(()=>{var n;(n=v.value)==null||n.focus()}))}catch(o){console.error("åˆ›å»ºæ–°ä¼šè¯å¤±è´¥:",o)}},P=m(null),D=m(""),ze=o=>{P.value=o,D.value=o.title||o.pageTitle||"",S(()=>{const e=document.querySelector(".rename-input");e==null||e.focus(),e==null||e.select()})},me=async()=>{if(!(!P.value||!D.value.trim()))try{await chrome.runtime.sendMessage({type:"RENAME_SESSION",payload:{sessionId:P.value.id,title:D.value.trim()}});const o=V.value.find(e=>e.id===P.value.id);o&&(o.title=D.value.trim()),P.value=null,D.value=""}catch(o){console.error("é‡å‘½åä¼šè¯å¤±è´¥:",o)}},ae=()=>{P.value=null,D.value=""},Ge=async o=>{try{const e=await chrome.runtime.sendMessage({type:"EXPORT_SESSION",payload:{sessionId:o}});if(e.success&&e.data){const s=e.data,n=`chat-session-${s.session.title||o}-${new Date().toISOString().slice(0,10)}.json`;Fe(s,n)}}catch(e){console.error("å¯¼å‡ºä¼šè¯å¤±è´¥:",e)}},Fe=(o,e)=>{const s=new Blob([JSON.stringify(o,null,2)],{type:"application/json"}),n=URL.createObjectURL(s),l=document.createElement("a");l.href=n,l.download=e,document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(n)},E=m(null),Ke=o=>{E.value=o},Xe=async()=>{if(E.value)try{await chrome.runtime.sendMessage({type:"DELETE_SESSION",payload:{sessionId:E.value.id}}),V.value=V.value.filter(o=>o.id!==E.value.id),k.value===E.value.id&&await ne(),E.value=null}catch(o){console.error("åˆ é™¤ä¼šè¯å¤±è´¥:",o)}},fe=()=>{E.value=null};return(o,e)=>(u(),p("div",at,[t("div",rt,[t("div",it,[t("div",lt,[e[8]||(e[8]=t("div",{class:"logo-icon"},[t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[t("path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})])],-1)),t("div",ct,[e[7]||(e[7]=t("h3",null,"AI Chat Assistant",-1)),t("div",dt,[C.value?(u(),p("span",{key:0,class:"agent-badge",title:C.value.name},x(C.value.name),9,ut)):w("",!0),N.value?(u(),p("span",pt,x(N.value),1)):w("",!0)])])]),t("div",vt,[t("div",{class:"session-selector",onClick:L(Te,["stop"])},[t("button",{class:B(["icon-btn",{active:U.value}]),title:"åˆ‡æ¢ä¼šè¯"},[...e[9]||(e[9]=[t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[t("path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)])],2),U.value?(u(),p("div",yt,[t("div",gt,[e[11]||(e[11]=t("span",null,"å†å²ä¼šè¯",-1)),t("button",{class:"session-new-btn",onClick:L(ne,["stop"])},[...e[10]||(e[10]=[t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[t("line",{x1:"12",y1:"5",x2:"12",y2:"19","stroke-width":"2","stroke-linecap":"round"}),t("line",{x1:"5",y1:"12",x2:"19",y2:"12","stroke-width":"2","stroke-linecap":"round"})],-1),he(" æ–°å»º ",-1)])])]),t("div",mt,[te.value?(u(),p("div",ft,[...e[12]||(e[12]=[t("div",{class:"loading-spinner"},null,-1),t("span",null,"åŠ è½½ä¸­...",-1)])])):V.value.length===0?(u(),p("div",kt," æš‚æ— å†å²ä¼šè¯ ")):(u(!0),p(H,{key:2},Y(V.value,s=>(u(),p("div",{key:s.id,class:B(["session-dropdown-item",{selected:k.value===s.id}]),onClick:L(n=>Ie(s),["stop"])},[t("div",wt,[t("div",bt,x(s.title||s.pageTitle||"æœªå‘½åä¼šè¯"),1),t("div",_t,[s.pageUrl?(u(),p("span",xt,x(Me(s.pageUrl)),1)):w("",!0),t("span",Ct,x(Ae(s.updatedAt)),1)])]),t("div",Tt,[t("button",{class:"session-action-btn",onClick:L(n=>ze(s),["stop"]),title:"é‡å‘½å"},[...e[13]||(e[13]=[t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",width:"14",height:"14"},[t("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}),t("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)])],8,St),t("button",{class:"session-action-btn",onClick:L(n=>Ge(s.id),["stop"]),title:"å¯¼å‡º"},[...e[14]||(e[14]=[t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",width:"14",height:"14"},[t("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}),t("polyline",{points:"7 10 12 15 17 10","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}),t("line",{x1:"12",y1:"15",x2:"12",y2:"3","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)])],8,It),t("button",{class:"session-action-btn delete",onClick:L(n=>Ke(s),["stop"]),title:"åˆ é™¤"},[...e[15]||(e[15]=[t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",width:"14",height:"14"},[t("polyline",{points:"3 6 5 6 21 6","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}),t("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)])],8,Mt)]),k.value===s.id?(u(),p("div",At,[...e[16]||(e[16]=[t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[t("polyline",{points:"20 6 9 17 4 12","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)])])):w("",!0)],10,ht))),128))])])):w("",!0)]),t("button",{class:"icon-btn",onClick:ne,title:"æ–°å»ºä¼šè¯"},[...e[17]||(e[17]=[t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[t("line",{x1:"12",y1:"5",x2:"12",y2:"19","stroke-width":"2","stroke-linecap":"round"}),t("line",{x1:"5",y1:"12",x2:"19",y2:"12","stroke-width":"2","stroke-linecap":"round"})],-1)])]),t("button",{class:"icon-btn",onClick:Je,title:"å¸®åŠ©æ–‡æ¡£"},[...e[18]||(e[18]=[t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[t("circle",{cx:"12",cy:"12",r:"10","stroke-width":"2"}),t("path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}),t("line",{x1:"12",y1:"17",x2:"12.01",y2:"17","stroke-width":"2","stroke-linecap":"round"})],-1)])]),t("button",{class:"icon-btn",onClick:Ve,title:"è®¾ç½®"},[...e[19]||(e[19]=[t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[t("circle",{cx:"12",cy:"12",r:"3","stroke-width":"2"}),t("path",{d:"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)])]),oe.value?(u(),p("button",{key:0,class:B(["icon-btn",{active:q.value}]),onClick:Pe,title:"å›ºå®šçª—å£"},[...e[20]||(e[20]=[t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[t("path",{d:"M16 4v8l3 3-2 2-3-3-4 4-2-2 4-4-3-3 2-2 3 3V4h2z","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)])],2)):w("",!0),oe.value?(u(),p("button",{key:1,class:"icon-btn",onClick:qe,title:"å…¨å±æ‰“å¼€"},[...e[21]||(e[21]=[t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[t("path",{d:"M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)])])):w("",!0),t("button",{class:"icon-btn",onClick:He,title:"å…³é—­"},[...e[22]||(e[22]=[t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[t("line",{x1:"18",y1:"6",x2:"6",y2:"18","stroke-width":"2","stroke-linecap":"round"}),t("line",{x1:"6",y1:"6",x2:"18",y2:"18","stroke-width":"2","stroke-linecap":"round"})],-1)])])])]),P.value?(u(),p("div",{key:0,class:"modal-overlay",onClick:ae},[t("div",{class:"modal-dialog",onClick:e[1]||(e[1]=L(()=>{},["stop"]))},[e[23]||(e[23]=t("div",{class:"modal-header"},"é‡å‘½åä¼šè¯",-1)),t("div",Lt,[re(t("input",{type:"text",class:"rename-input","onUpdate:modelValue":e[0]||(e[0]=s=>D.value=s),onKeyup:[le(me,["enter"]),le(ae,["esc"])],placeholder:"è¾“å…¥æ–°åç§°"},null,544),[[ie,D.value]])]),t("div",{class:"modal-footer"},[t("button",{class:"btn btn-secondary",onClick:ae},"å–æ¶ˆ"),t("button",{class:"btn btn-primary",onClick:me},"ç¡®å®š")])])])):w("",!0),E.value?(u(),p("div",{key:1,class:"modal-overlay",onClick:fe},[t("div",{class:"modal-dialog",onClick:e[2]||(e[2]=L(()=>{},["stop"]))},[e[25]||(e[25]=t("div",{class:"modal-header"},"ç¡®è®¤åˆ é™¤",-1)),t("div",Et,[t("p",null,'ç¡®å®šè¦åˆ é™¤ä¼šè¯ "'+x(E.value.title||E.value.pageTitle||"æœªå‘½åä¼šè¯")+'" å—ï¼Ÿ',1),e[24]||(e[24]=t("p",{class:"modal-warning"},"æ­¤æ“ä½œä¸å¯æ¢å¤",-1))]),t("div",{class:"modal-footer"},[t("button",{class:"btn btn-secondary",onClick:fe},"å–æ¶ˆ"),t("button",{class:"btn btn-danger",onClick:Xe},"åˆ é™¤")])])])):w("",!0),t("div",{class:"chat-messages",ref_key:"messagesContainer",ref:a},[r.value.length===0?(u(),p("div",jt,[...e[26]||(e[26]=[t("p",null,"å¼€å§‹å¯¹è¯å§",-1)])])):w("",!0),(u(!0),p(H,null,Y(r.value,s=>(u(),p("div",{key:s.id||s.createdAt,class:B(["message",s.role,"message-in"])},[s.role==="user"?(u(),p(H,{key:0},[t("div",Nt,x(Le(s)),1),t("span",Bt,x(ge(s.createdAt)),1)],64)):(u(),p(H,{key:1},[t("div",Rt,[s.think?(u(),p("div",Dt,[e[27]||(e[27]=t("div",{class:"think-header"},[t("span",{class:"think-icon"},"ğŸ’­"),t("span",{class:"think-label"},"æ€è€ƒè¿‡ç¨‹")],-1)),t("div",$t,x(s.think),1)])):w("",!0),(u(!0),p(H,null,Y(s.blocks,(n,l)=>(u(),p(H,{key:l},[n.type==="text"?(u(),p("div",Ot,[e[28]||(e[28]=t("span",{class:"block-indicator text-indicator"},"â–¶",-1)),t("span",Ut,x(n.text),1)])):n.type==="tool_use"?(u(),p("div",Pt,[t("div",Ht,[e[29]||(e[29]=t("span",{class:"block-indicator tool-indicator"},"âš™",-1)),t("span",qt,x(n.name),1),n.status==="approved"?(u(),p("span",Jt,"å·²æ‰¹å‡†")):n.status==="rejected"?(u(),p("span",Vt,"å·²æ‹’ç»")):w("",!0)]),t("div",zt,[t("div",{class:"tool-params-header",onClick:e[3]||(e[3]=y=>je(y))},[...e[30]||(e[30]=[t("svg",{class:"collapse-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[t("polyline",{points:"6 9 12 15 18 9","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1),t("span",{class:"tool-params-label"},"å‚æ•°",-1)])]),t("pre",{class:B(["tool-params",{collapsed:!1}])},[t("code",{innerHTML:Ee(n.input)},null,8,Gt)])]),n.status==="pending"&&!b.value?(u(),p("div",Ft,[t("button",{class:"btn btn-approve",onClick:y=>ye(n.id,!0)},"Approve",8,Kt),t("button",{class:"btn btn-reject",onClick:y=>ye(n.id,!1)},"Reject",8,Xt)])):w("",!0)])):n.type==="summary"?(u(),p("div",Wt,[e[31]||(e[31]=t("div",{class:"summary-header"},[t("span",{class:"summary-icon"},"âœ…"),t("span",{class:"summary-label"},"ä»»åŠ¡å®Œæˆ")],-1)),t("div",Qt,x(n.text),1)])):w("",!0)],64))),128))]),t("span",Yt,x(ge(s.createdAt)),1)],64))],2))),128)),b.value?(u(),p("div",Zt,[...e[32]||(e[32]=[t("div",{class:"assistant-content"},[t("div",{class:"message-box assistant-box typing"},[t("span"),t("span"),t("span")])],-1)])])):w("",!0)],512),R.value.total>0||_.value?(u(),p("div",es,[t("div",ts,[t("div",ss,[t("span",os,"å·²ç”¨ "+x(se(R.value.total)),1),e[33]||(e[33]=t("span",{class:"token-separator"},"/",-1)),t("span",ns,x(se(ce)),1),t("span",{class:B(["token-remaining",{warning:K.value>80}])}," (å‰©ä½™ "+x(se(ce-R.value.total))+") ",3)]),K.value>80?(u(),p("span",as,"å»ºè®®å¼€å¯æ–°ä¼šè¯")):w("",!0)]),t("div",rs,[t("div",{class:B(["token-progress-fill",{warning:K.value>80,danger:K.value>95}]),style:tt({width:Math.min(K.value,100)+"%"})},null,6)])])):w("",!0),t("div",is,[t("div",{class:"agent-selector",onClick:xe},[t("div",{class:B(["agent-selector-btn",{active:O.value}])},[e[34]||(e[34]=t("svg",{viewBox:"0 0 24 24",fill:"currentColor"},[t("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 3c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm0 14.2c-2.5 0-4.71-1.28-6-3.22.03-1.99 4-3.08 6-3.08 1.99 0 5.97 1.09 6 3.08-1.29 1.94-3.5 3.22-6 3.22z"})],-1)),C.value?(u(),p("span",ls)):w("",!0)],2),O.value?(u(),p("div",cs,[t("div",ds,[re(t("input",{type:"text","onUpdate:modelValue":e[4]||(e[4]=s=>G.value=s),placeholder:"æœç´¢ Agent...",onClick:e[5]||(e[5]=L(()=>{},["stop"]))},null,512),[[ie,G.value]])]),t("div",us,[ee.value?(u(),p("div",ps,[...e[35]||(e[35]=[t("div",{class:"loading-spinner"},null,-1),t("span",null,"åŠ è½½ä¸­...",-1)])])):de.value.length===0?(u(),p("div",vs," æš‚æ— å¯ç”¨ Agent ")):(u(!0),p(H,{key:2},Y(de.value,s=>{var n,l;return u(),p("div",{key:s.id,class:B(["agent-dropdown-item",{selected:((n=C.value)==null?void 0:n.id)===s.id,recommended:s.id===F.value}]),onClick:L(y=>Ce(s),["stop"])},[e[37]||(e[37]=t("div",{class:"agent-dropdown-avatar"},[t("svg",{viewBox:"0 0 24 24",fill:"currentColor"},[t("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 3c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm0 14.2c-2.5 0-4.71-1.28-6-3.22.03-1.99 4-3.08 6-3.08 1.99 0 5.97 1.09 6 3.08-1.29 1.94-3.5 3.22-6 3.22z"})])],-1)),t("div",gs,[t("div",ms,[he(x(s.name)+" ",1),s.id===F.value?(u(),p("span",fs,"æ¨è")):w("",!0)]),t("div",ks,x(s.description),1)]),((l=C.value)==null?void 0:l.id)===s.id?(u(),p("div",hs,[...e[36]||(e[36]=[t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[t("polyline",{points:"20 6 9 17 4 12","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)])])):w("",!0)],10,ys)}),128))])])):w("",!0)]),re(t("textarea",{"onUpdate:modelValue":e[6]||(e[6]=s=>g.value=s),onKeydown:le(L(ve,["exact","prevent"]),["enter"]),placeholder:"è¾“å…¥æ¶ˆæ¯... (Enterå‘é€)",rows:"1",ref_key:"inputArea",ref:v},null,40,ws),[[ie,g.value]]),t("button",{class:"send-btn",onClick:ve,disabled:!g.value.trim()||b.value},[...e[38]||(e[38]=[t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[t("line",{x1:"22",y1:"2",x2:"11",y2:"13","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}),t("polygon",{points:"22 2 15 22 11 13 2 9 22 2","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)])],8,bs)])])]))}}),xs=st(_s,[["__scopeId","data-v-a401f5ff"]]),Cs=ot(xs);Cs.mount("#app");
